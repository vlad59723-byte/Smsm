<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Prompt Creator Pro (Ultimate Edition) v11 Enhanced</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
        }
    </script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script>
        // To prevent FOUC (Flash of Unstyled Content), we set the dark mode class immediately
        if (localStorage.getItem('darkMode') === 'true') {
            document.documentElement.classList.add('dark');
        }
    </script>
    <script src="data.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/tippy.js@6/dist/tippy.css"/>
    <style>
        :root {
            --primary-color: #3B82F6; 
            --secondary-color: #2563EB; 
            --accent-color: #EF4444; 
            --background-color: #F9FAFB;
            --card-background-color: #FFFFFF;
            --text-color: #1F2937; 
            --light-gray: #E5E7EB; 
            --medium-gray: #6B7280; 
            --dark-gray: #374151; 
            --success-color: #10B981; 
            --warning-color: #F59E0B; 
            --border-color: #E5E7EB;
        }

        .dark {
            --background-color: #111827;
            --card-background-color: #1F2937;
            --text-color: #F9FAFB;
            --light-gray: #374151;
            --dark-gray: #9CA3AF;
            --border-color: #374151;
        }

        body {
            font-family: 'Inter', sans-serif;
            line-height: 1.6;
            color: var(--text-color);
            background-color: var(--background-color);
        }
        input[type="range"] {
            -webkit-appearance: none;
            appearance: none;
            width: 100%;
            height: 8px;
            background: var(--light-gray);
            border-radius: 9999px;
            outline: none;
        }
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            background: var(--primary-color);
            cursor: pointer;
            border-radius: 50%;
            border: 2px solid white;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        .model-radio:checked + span {
            border-color: var(--primary-color);
            background-color: #EFF6FF; 
            box-shadow: 0 0 0 2px var(--primary-color);
        }
        .toggle-checkbox:checked + .toggle-label {
            background-color: var(--success-color);
        }
        .toggle-checkbox:checked + .toggle-label::after {
            transform: translateX(100%);
        }
        .toggle-label {
            width: 40px;
            height: 20px;
            background-color: var(--medium-gray);
            border-radius: 9999px;
            position: relative;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        .toggle-label::after {
            content: '';
            position: absolute;
            top: 2px;
            left: 2px;
            width: 16px;
            height: 16px;
            background-color: white;
            border-radius: 50%;
            transition: transform 0.3s;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeOut {
            from {
                opacity: 1;
                transform: translateY(0);
            }
            to {
                opacity: 0;
                transform: translateY(10px);
            }
        }

        .notification-fade-in {
            animation: fadeIn 0.3s ease-out forwards;
        }

        .notification-fade-out {
            animation: fadeOut 0.3s ease-in forwards;
        }
    </style>
</head>
<body class="min-h-screen flex flex-col">

    <header class="bg-white shadow-md sticky top-0 z-50">
        <div class="container mx-auto max-w-6xl px-4 py-4 flex justify-between items-center">
            <div class="flex items-center space-x-3">
                <img src="https://placehold.co/40x40/3B82F6/FFFFFF?text=AI" alt="AI Prompt Creator" class="rounded-lg">
                <h1 class="text-2xl font-bold text-blue-600">AI Prompt Creator Pro (Ultimate) v11 Enhanced</h1>
            </div>
            <nav class="flex items-center space-x-4">
                <ul class="flex space-x-4 md:space-x-6">
                    <li><a href="#" class="font-medium text-gray-700 hover:text-blue-600 transition-colors duration-200 border-b-2 border-blue-600 pb-1">–ì–ª–∞–≤–Ω–∞—è</a></li>
                </ul>
                <div class="flex items-center">
                    <span class="text-sm font-medium text-gray-600">Light</span>
                    <label for="dark-mode-toggle" class="relative inline-flex items-center cursor-pointer mx-2">
                        <input type="checkbox" id="dark-mode-toggle" class="sr-only peer">
                        <div class="w-11 h-6 bg-gray-200 rounded-full peer peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-blue-600"></div>
                    </label>
                    <span class="text-sm font-medium text-gray-600">Dark</span>
                </div>
            </nav>
        </div>
    </header>

    <main class="flex-grow">
        <section class="bg-gradient-to-r from-blue-600 to-blue-500 text-white py-16 text-center">
            <div class="container mx-auto max-w-4xl px-4">
                <h2 class="text-4xl md:text-5xl font-bold mb-4">–°–æ–∑–¥–∞–≤–∞–π—Ç–µ –∏–¥–µ–∞–ª—å–Ω—ã–µ –ø—Ä–æ–º–ø—Ç—ã –¥–ª—è Sora –∏ Veo</h2>
                <p class="text-xl text-blue-100 max-w-2xl mx-auto">–ü—Ä–µ–≤—Ä–∞—Ç–∏—Ç–µ –≤–∞—à—É –ø—Ä–æ—Å—Ç—É—é –∏–¥–µ—é –≤ –¥–µ—Ç–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π, –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π –ø—Ä–æ–º–ø—Ç –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –≤–∏–¥–µ–æ.</p>
            </div>
        </section>

        <section class="py-12 md:py-16">
            <div class="container mx-auto max-w-4xl px-4">
                
<div class="mb-8 p-6 bg-white rounded-xl shadow-lg">
                    <h3 class="text-xl font-semibold mb-5 text-gray-800">1. –í—ã–±–µ—Ä–∏—Ç–µ –º–æ–¥–µ–ª—å –ò–ò:</h3>
                    
                    <div class="mb-4 p-4 bg-blue-50 border border-blue-200 rounded-lg">
                        <label class="flex items-center cursor-pointer">
                            <input type="checkbox" id="enable-model-selection" class="w-5 h-5 text-blue-600 border-gray-300 rounded focus:ring-blue-500" checked>
                            <span class="ml-3 text-sm font-medium text-gray-700">–í–∫–ª—é—á–∏—Ç—å –≤—ã–±–æ—Ä –º–µ–∂–¥—É Sora –∏ Veo (–µ—Å–ª–∏ –æ—Ç–∫–ª—é—á–µ–Ω–æ, –¥–æ—Å—Ç—É–ø–Ω—ã –≤—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏)</span>
                        </label>
                        <p class="text-xs text-gray-500 mt-2 ml-8">–ü—Ä–∏ –æ—Ç–∫–ª—é—á–µ–Ω–∏–∏ —á–µ–∫–±–æ–∫—Å–∞ –≤—ã —Å–º–æ–∂–µ—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏, –≤–∫–ª—é—á–∞—è Veo-—Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ê—É–¥–∏–æ).</p>
                    </div>

                    <h3 class="text-xl font-semibold mt-6 mb-3 text-gray-800">1.5. –í—ã–±–µ—Ä–∏—Ç–µ –º–æ–¥–µ–ª—å Gemini:</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <label class="cursor-pointer">
                            <input type="radio" name="generation-model" value="gemini-2.5-flash" class="model-radio hidden" checked>
                            <span class="model-radio-label flex items-center p-5 border-2 border-gray-200 rounded-lg transition-all duration-200 hover:border-blue-500">
                                <div>
                                    <span class="text-lg font-bold text-gray-900">Gemini 2.5 Flash</span>
                                    <span class="block text-sm text-gray-500">–ë—ã—Å—Ç—Ä–∞—è / –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é</span>
                                </div>
                            </span>
                        </label>
                        <label class="cursor-pointer">
                            <input type="radio" name="generation-model" value="gemini-2.5-pro" class="model-radio hidden">
                            <span class="model-radio-label flex items-center p-5 border-2 border-gray-200 rounded-lg transition-all duration-200 hover:border-blue-500">
                                <div>
                                    <span class="text-lg font-bold text-gray-900">Gemini 2.5 Pro</span>
                                    <span class="block text-sm text-gray-500">–ú–æ—â–Ω–∞—è / –î–ª—è —Å–ª–æ–∂–Ω—ã—Ö –ø—Ä–æ–º–ø—Ç–æ–≤</span>
                                </div>
                            </span>
                        </label>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4" id="model-selection-container">
                        <label class="cursor-pointer">
                            <input type="radio" name="model" value="sora" class="model-radio hidden" checked>
                            <span class="model-radio-label flex items-center p-5 border-2 border-gray-200 rounded-lg transition-all duration-200 hover:border-blue-500">
                                <svg class="w-8 h-8 mr-4 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"></path></svg>
                                <div>
                                    <span class="text-lg font-bold text-gray-900">Sora</span>
                                    <span class="block text-sm text-gray-500">OpenAI</span>
                                </div>
                            </span>
                        </label>
                        <label class="cursor-pointer">
                            <input type="radio" name="model" value="veo" class="model-radio hidden">
                            <span class="model-radio-label flex items-center p-5 border-2 border-gray-200 rounded-lg transition-all duration-200 hover:border-blue-500">
                                <svg class="w-8 h-8 mr-4 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                                <div>
                                    <span class="text-lg font-bold text-gray-900">Veo</span>
                                    <span class="block text-sm text-gray-500">Google DeepMind</span>
                                </div>
                            </span>
                        </label>
                    </div>

                <!-- Presets Section -->
                <div class="mb-8 p-6 bg-white rounded-xl shadow-lg">
                    <h3 class="text-xl font-semibold mb-5 text-gray-800">2. –®–∞–±–ª–æ–Ω—ã (–ü—Ä–µ—Å–µ—Ç—ã):</h3>
                    <div class="flex justify-between items-center mb-4">
                        <input type="text" id="preset-filter" class="w-1/2 p-2 border border-gray-300 rounded-lg" placeholder="–§–∏–ª—å—Ç—Ä –ø—Ä–µ—Å–µ—Ç–æ–≤...">
                        <select id="preset-sort" class="w-1/2 p-2 border border-gray-300 rounded-lg">
                            <option value="default">–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é</option>
                            <option value="name-asc">–ü–æ –∏–º–µ–Ω–∏ (–ê-–Ø)</option>
                            <option value="name-desc">–ü–æ –∏–º–µ–Ω–∏ (–Ø-–ê)</option>
                            <option value="style">–ü–æ —Å—Ç–∏–ª—é</option>
                            <option value="mood">–ü–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—é</option>
                        </select>
                    </div>
                    <div class="flex flex-wrap gap-3" id="preset-buttons">
                        <button data-preset="cinematic-epic" class="preset-btn px-4 py-2 bg-gray-100 text-gray-700 rounded-lg shadow-sm hover:bg-gray-200 transition-colors duration-200 text-sm font-medium">–≠–ø–∏—á–µ—Å–∫–∏–π –ö–∏–Ω–µ–º–∞—Ç–æ–≥—Ä–∞—Ñ</button>
                        <button data-preset="cyberpunk-neon" class="preset-btn px-4 py-2 bg-gray-100 text-gray-700 rounded-lg shadow-sm hover:bg-gray-200 transition-colors duration-200 text-sm font-medium">–ö–∏–±–µ—Ä–ø–∞–Ω–∫ –ù–µ–æ–Ω</button>
                        <button data-preset="pixar-animation" class="preset-btn px-4 py-2 bg-gray-100 text-gray-700 rounded-lg shadow-sm hover:bg-gray-200 transition-colors duration-200 text-sm font-medium">–ê–Ω–∏–º–∞—Ü–∏—è Pixar</button>
                        <button data-preset="documentary-nature" class="preset-btn px-4 py-2 bg-gray-100 text-gray-700 rounded-lg shadow-sm hover:bg-gray-200 transition-colors duration-200 text-sm font-medium">–î–æ–∫—É–º–µ–Ω—Ç–∞–ª—å–Ω—ã–π (–ü—Ä–∏—Ä–æ–¥–∞)</button>
                        <button data-preset="low-key-noir" class="preset-btn px-4 py-2 bg-gray-100 text-gray-700 rounded-lg shadow-sm hover:bg-gray-200 transition-colors duration-200 text-sm font-medium">–ú—Ä–∞—á–Ω—ã–π –ù—É–∞—Ä</button>
                        <button data-preset="vintage-vhs" class="preset-btn px-4 py-2 bg-gray-100 text-gray-700 rounded-lg shadow-sm hover:bg-gray-200 transition-colors duration-200 text-sm font-medium">–í–∏–Ω—Ç–∞–∂ VHS</button>
                        <button data-preset="fantasy-magic" class="preset-btn px-4 py-2 bg-gray-100 text-gray-700 rounded-lg shadow-sm hover:bg-gray-200 transition-colors duration-200 text-sm font-medium">–§—ç–Ω—Ç–µ–∑–∏ –ú–∞–≥–∏—è</button>
                        <button data-preset="wes-anderson" class="preset-btn px-4 py-2 bg-gray-100 text-gray-700 rounded-lg shadow-sm hover:bg-gray-200 transition-colors duration-200 text-sm font-medium">–°—Ç–∏–ª—å Wes Anderson</button>
                        <button data-preset="post-apocalypse" class="preset-btn px-4 py-2 bg-gray-100 text-gray-700 rounded-lg shadow-sm hover:bg-gray-200 transition-colors duration-200 text-sm font-medium">–ü–æ—Å—Ç–∞–ø–æ–∫–∞–ª–∏–ø—Å–∏—Å</button>
                        <button data-preset="anime-ghibli" class="preset-btn px-4 py-2 bg-gray-100 text-gray-700 rounded-lg shadow-sm hover:bg-gray-200 transition-colors duration-200 text-sm font-medium">–ê–Ω–∏–º–µ (Ghibli)</button>
                        <button data-preset="manga-style" class="preset-btn px-4 py-2 bg-gray-100 text-gray-700 rounded-lg shadow-sm hover:bg-gray-200 transition-colors duration-200 text-sm font-medium">–ú–∞–Ω–≥–∞ (–ß/–ë)</button>
                        <button data-preset="lovecraft-horror" class="preset-btn px-4 py-2 bg-gray-100 text-gray-700 rounded-lg shadow-sm hover:bg-gray-200 transition-colors duration-200 text-sm font-medium">–•–æ—Ä—Ä–æ—Ä (–õ–∞–≤–∫—Ä–∞—Ñ—Ç)</button>
                        <button data-preset="sci-fi-retro" class="preset-btn px-4 py-2 bg-gray-100 text-gray-700 rounded-lg shadow-sm hover:bg-gray-200 transition-colors duration-200 text-sm font-medium">–ù/—Ñ (–†–µ—Ç—Ä–æ 70-—Ö)</button>
                        <button data-preset="romantic-scene" class="preset-btn px-4 py-2 bg-gray-100 text-gray-700 rounded-lg shadow-sm hover:bg-gray-200 transition-colors duration-200 text-sm font-medium">–†–æ–º–∞–Ω—Ç–∏–∫–∞</button>
                        <button data-preset="3d-modeling" class="preset-btn px-4 py-2 bg-gray-100 text-gray-700 rounded-lg shadow-sm hover:bg-gray-200 transition-colors duration-200 text-sm font-medium">3D-–º–æ–¥–µ–ª–∏—Ä–æ–≤–∞–Ω–∏–µ</button>
                        <button data-preset="cinematic-noir" class="preset-btn px-4 py-2 bg-gray-100 text-gray-700 rounded-lg shadow-sm hover:bg-gray-200 transition-colors duration-200 text-sm font-medium">–ö–∏–Ω–µ–º–∞—Ç–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–æ–µ –ù—É–∞—Ä</button>
                        <button data-preset="cel-shaded-comic" class="preset-btn px-4 py-2 bg-gray-100 text-gray-700 rounded-lg shadow-sm hover:bg-gray-200 transition-colors duration-200 text-sm font-medium">–°—Ç–∏–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π –ö–æ–º–∏–∫—Å</button>
                        <button data-preset="street-photography" class="preset-btn px-4 py-2 bg-gray-100 text-gray-700 rounded-lg shadow-sm hover:bg-gray-200 transition-colors duration-200 text-sm font-medium">–£–ª–∏—á–Ω–∞—è –§–æ—Ç–æ–≥—Ä–∞—Ñ–∏—è</button>
                        <button data-preset="steampunk" class="preset-btn px-4 py-2 bg-gray-100 text-gray-700 rounded-lg shadow-sm hover:bg-gray-200 transition-colors duration-200 text-sm font-medium">–°—Ç–∏–º–ø–∞–Ω–∫</button>
                        <button data-preset="ai-art" class="preset-btn px-4 py-2 bg-gray-100 text-gray-700 rounded-lg shadow-sm hover:bg-gray-200 transition-colors duration-200 text-sm font-medium">AI-Art</button>
                        <button data-preset="hyper-realistic-macro" class="preset-btn px-4 py-2 bg-gray-100 text-gray-700 rounded-lg shadow-sm hover:bg-gray-200 transition-colors duration-200 text-sm font-medium">Hyper-Realistic Macro</button>
                        <button data-preset="glitchcore-vaporwave" class="preset-btn px-4 py-2 bg-gray-100 text-gray-700 rounded-lg shadow-sm hover:bg-gray-200 transition-colors duration-200 text-sm font-medium">Glitchcore/Vaporwave</button>
                        <button data-preset="stop-motion-claymation" class="preset-btn px-4 py-2 bg-gray-100 text-gray-700 rounded-lg shadow-sm hover:bg-gray-200 transition-colors duration-200 text-sm font-medium">Stop-Motion Claymation</button>
                    </div>
                    <p class="text-sm text-gray-500 mt-3">–ù–∞–∂–º–∏—Ç–µ, —á—Ç–æ–±—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø–æ–ª–Ω–∏—Ç—å –≤—Å–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã.</p>
                    <div class="mt-4" id="custom-presets-container"></div>
                    <button id="create-preset-btn" class="mt-4 w-full px-4 py-2 bg-green-500 text-white rounded-lg shadow-sm hover:bg-green-600 transition-colors duration-200 text-sm font-medium">–°–æ–∑–¥–∞—Ç—å —Å–≤–æ–π –ø—Ä–µ—Å–µ—Ç</button>
                    <button id="generate-custom-preset-btn" class="mt-4 w-full px-4 py-2 bg-blue-500 text-white rounded-lg shadow-sm hover:bg-blue-600 transition-colors duration-200 text-sm font-medium">–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–µ—Å–µ—Ç (AI)</button>
                </div>
                <!-- End Presets Section -->
                <!-- Detail Level Section -->
                <div class="mb-8 p-6 bg-white rounded-xl shadow-lg" title="–í—ã–±–µ—Ä–∏—Ç–µ —É—Ä–æ–≤–µ–Ω—å –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ç–µ–≥–æ–≤ –∫–∞—á–µ—Å—Ç–≤–∞ –∏ –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏.">
                    <h3 class="text-xl font-semibold mb-5 text-gray-800">2.5. –£—Ä–æ–≤–µ–Ω—å –î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏:</h3>
                    <div class="flex flex-wrap gap-3" id="detail-level-buttons">
                        <button data-level="basic" class="detail-level-btn px-4 py-2 bg-gray-100 text-gray-700 rounded-lg shadow-sm hover:bg-gray-200 transition-colors duration-200 text-sm font-medium" title="–î–æ–±–∞–≤–ª—è–µ—Ç: high quality, detailed">Basic</button>
                        <button data-level="detailed" class="detail-level-btn px-4 py-2 bg-gray-100 text-gray-700 rounded-lg shadow-sm hover:bg-gray-200 transition-colors duration-200 text-sm font-medium" title="–î–æ–±–∞–≤–ª—è–µ—Ç: masterpiece, best quality, highly detailed, photorealistic, cinematic light">Detailed</button>
                        <button data-level="masterpiece" class="detail-level-btn px-4 py-2 bg-gray-100 text-gray-700 rounded-lg shadow-sm hover:bg-gray-200 transition-colors duration-200 text-sm font-medium" title="–î–æ–±–∞–≤–ª—è–µ—Ç: ultra-detailed, 8k, extremely detailed face, volumetric light, trending on artstation, unreal engine 5, octane render">Masterpiece</button>
                    </div>
                    <p class="text-sm text-gray-500 mt-3">–î–æ–±–∞–≤–ª—è–µ—Ç —Ç–µ–≥–∏ –∫–∞—á–µ—Å—Ç–≤–∞ –≤ –ø–æ–ª–µ "–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–µ—Ç–∞–ª–∏".</p>
                </div>
                <!-- End Detail Level Section -->

                <!-- Operating Modes Section -->
                <div class="mb-8 p-6 bg-white rounded-xl shadow-lg">
                    <h3 class="text-xl font-semibold mb-5 text-gray-800">3. –†–µ–∂–∏–º –†–∞–±–æ—Ç—ã:</h3>
                    <select id="operating-mode" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500" aria-label="Select Operating Mode">
                        <option value="general" selected>–û–±—â–∏–π (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)</option>
                        <option value="no-names">"–ë–µ–∑ –∏–º–µ–Ω"</option>
                        <option value="base64">"Base64 –∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ"</option>
                    </select>
                    <p class="text-sm text-gray-500 mt-3">–í—ã–±–µ—Ä–∏—Ç–µ —Ä–µ–∂–∏–º –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –≤ –ø—Ä–æ–º–ø—Ç–µ.</p>
                    <!-- Sub-options for modes -->
                    <div id="no-names-options" class="hidden mt-4 space-y-2 p-4 bg-gray-50 rounded-lg border">
                        <label class="flex items-center">
                            <input type="checkbox" id="no-names-auto-analyze" class="form-checkbox h-5 w-5 text-blue-600">
                            <span class="ml-2 text-gray-700">–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)</span>
                        </label>
                        <div>
                            <label for="no-names-exceptions" class="block text-sm font-medium text-gray-700">–°–ø–∏—Å–æ–∫ –∏—Å–∫–ª—é—á–µ–Ω–∏–π (—á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é):</label>
                            <input type="text" id="no-names-exceptions" class="w-full p-2 mt-1 border border-gray-300 rounded-lg" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: John, Mary">
                        </div>
                    </div>
                    <div id="base64-options" class="hidden mt-4 space-y-2 p-4 bg-gray-50 rounded-lg border">
                        <label for="base64-encoding" class="block text-sm font-medium text-gray-700">–¢–∏–ø –∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è:</label>
                        <select id="base64-encoding" class="w-full p-2 border border-gray-300 rounded-lg">
                            <option value="base64">Base64</option>
                            <option value="rot13">ROT13</option>
                            <option value="url">URL Encoding</option>
                        </select>
                    </div>
                </div>
                <!-- End Operating Modes Section -->

                <div class="mb-8 p-6 bg-white rounded-xl shadow-lg">
                    <h3 class="text-xl font-semibold mb-4 text-gray-800">4. –í–≤–µ–¥–∏—Ç–µ –≤–∞—à—É –∏–¥–µ—é:</h3>
                    <div class="space-y-4">
                        <div>
                            <label for="subject-input" class="block text-sm font-medium text-gray-700">–°—É–±—ä–µ–∫—Ç/–û–±—ä–µ–∫—Ç (–û —á–µ–º/–∫–æ–º):</label>
                            <textarea id="subject-input" class="w-full min-h-[80px] p-4 border border-gray-300 rounded-lg text-base shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –∫–∏–±–µ—Ä–ø–∞–Ω–∫-–Ω–∏–Ω–¥–∑—è" aria-label="Subject or Object of the prompt"></textarea>
                        </div>
                        <div>
                            <label for="style-lighting-input" class="block text-sm font-medium text-gray-700">–°—Ç–∏–ª—å/–û—Å–≤–µ—â–µ–Ω–∏–µ:</label>
                            <textarea id="style-lighting-input" class="w-full min-h-[80px] p-4 border border-gray-300 rounded-lg text-base shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –≤ —Å—Ç–∏–ª–µ –Ω—É–∞—Ä, –Ω–µ–æ–Ω–æ–≤–æ–µ –æ—Å–≤–µ—â–µ–Ω–∏–µ"></textarea>
                        </div>
                        <div>
                            <label for="quality-resolution-input" class="block text-sm font-medium text-gray-700">–ö–∞—á–µ—Å—Ç–≤–æ/–†–∞–∑—Ä–µ—à–µ–Ω–∏–µ:</label>
                            <textarea id="quality-resolution-input" class="w-full min-h-[80px] p-4 border border-gray-300 rounded-lg text-base shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 8k, Masterpiece, Cinematic"></textarea>
                        </div>
                    </div>
                    
                    <div class="flex flex-col sm:flex-row gap-3 mt-4">
                        <button id="improve-btn" class="primary-btn flex-1 px-8 py-3 bg-blue-600 text-white text-lg font-semibold rounded-lg shadow-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-all duration-200 flex items-center justify-center">
                            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707m12.728 0l-.707-.707M12 21v-1m0-16a1 1 0 00-1 1v16a1 1 0 102 0V4a1 1 0 00-1-1z"></path></svg>
                            –£–ª—É—á—à–∏—Ç—å –ø—Ä–æ–º–ø—Ç
                        </button>
                        <button id="super-improve-btn" class="secondary-btn flex-1 px-8 py-3 bg-green-500 text-white text-lg font-semibold rounded-lg shadow-md hover:bg-green-600 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2 transition-all duration-200 flex items-center justify-center">
                            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path></svg>
                            –ò–¥–µ—è –µ—â–µ –ª—É—á—à–µ
                        </button>
                    </div>

                    <div class="mt-4">
                        <button id="ai-autopilot-btn" class="w-full px-8 py-3 bg-purple-600 text-white text-lg font-semibold rounded-lg shadow-md hover:bg-purple-700 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:ring-offset-2 transition-all duration-200 flex items-center justify-center">
                            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.75 17.25l-4.5-4.5m0 0l4.5-4.5m-4.5 4.5h16.5m-16.5 0h16.5"></path></svg>
                            ü§ñ AI-–ê–≤—Ç–æ–ø–∏–ª–æ—Ç (Gemini –≤—ã–±–µ—Ä–µ—Ç –≤—Å–µ)
                        </button>
                    </div>
                    <div class="mt-4">
                        <button id="translate-to-english-btn" class="w-full px-8 py-3 bg-indigo-600 text-white text-lg font-semibold rounded-lg shadow-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 transition-all duration-200 flex items-center justify-center">
                            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5h12M9 3v2m1.048 9.5A18.022 18.022 0 016.412 9m6.088 9h7M11 21l5-10 5 10M12.751 5C11.783 10.77 8.07 15.61 3 18.129"></path></svg>
                            üá¨üáß –ü–µ—Ä–µ–≤–µ—Å—Ç–∏ –ø—Ä–æ–º–ø—Ç –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–∏–π
                        </button>
                    </div>
                    <div class="mt-4">
                        <button id="generate-ideas-btn" class="w-full px-8 py-3 bg-yellow-600 text-white text-lg font-semibold rounded-lg shadow-md hover:bg-yellow-700 focus:outline-none focus:ring-2 focus:ring-yellow-500 focus:ring-offset-2 transition-all duration-200 flex items-center justify-center">
                            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707m12.728 0l-.707-.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path></svg>
                            üí° –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –∏–¥–µ–π –¥–ª—è –≤–∏–¥–µ–æ
                        </button>
                    </div>
                    <div class="mt-4">
                        <button id="generate-ideas-style-btn" class="w-full px-8 py-3 bg-yellow-600 text-white text-lg font-semibold rounded-lg shadow-md hover:bg-yellow-700 focus:outline-none focus:ring-2 focus:ring-yellow-500 focus:ring-offset-2 transition-all duration-200 flex items-center justify-center">
                            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707m12.728 0l-.707-.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path></svg>
                            üí° –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –∏–¥–µ–π –¥–ª—è —Å—Ç–∏–ª—è/–æ—Å–≤–µ—â–µ–Ω–∏—è
                        </button>
                    </div>
                    <div class="mt-4">
                        <button id="generate-ideas-quality-btn" class="w-full px-8 py-3 bg-yellow-600 text-white text-lg font-semibold rounded-lg shadow-md hover:bg-yellow-700 focus:outline-none focus:ring-2 focus:ring-yellow-500 focus:ring-offset-2 transition-all duration-200 flex items-center justify-center">
                            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707m12.728 0l-.707-.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path></svg>
                            üí° –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –∏–¥–µ–π –¥–ª—è –∫–∞—á–µ—Å—Ç–≤–∞/—Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è
                        </button>
                    </div>
                </div>
                <!-- Duration Section -->
                <div class="mb-8 p-6 bg-white rounded-xl shadow-lg parameter-group">
                    <div class="flex justify-between items-center mb-2">
                        <h3 class="text-xl font-semibold text-gray-800">5. –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å (—Å–µ–∫—É–Ω–¥—ã):</h3>
                        <label class="flex items-center cursor-pointer">
                            <input type="checkbox" id="toggle-duration" class="toggle-checkbox hidden" checked>
                            <span class="toggle-label"></span>
                        </label>
                    </div>
                    <div class="param-content">
                        <div class="flex flex-wrap gap-3 mb-4">
                            <button data-duration="8" class="duration-btn px-4 py-2 bg-blue-50 text-blue-700 rounded-lg shadow-sm hover:bg-blue-100 transition-colors duration-200 font-medium">8 —Å–µ–∫</button>
                            <button data-duration="10" class="duration-btn px-4 py-2 bg-blue-500 text-white rounded-lg shadow-sm hover:bg-blue-600 transition-colors duration-200 font-medium">10 —Å–µ–∫</button>
                            <button data-duration="15" class="duration-btn px-4 py-2 bg-blue-50 text-blue-700 rounded-lg shadow-sm hover:bg-blue-100 transition-colors duration-200 font-medium">15 —Å–µ–∫</button>
                        </div>
                        <label class="flex items-center space-x-2 mb-4">
                            <input type="checkbox" id="custom-duration-toggle" class="form-checkbox text-blue-600 h-5 w-5">
                            <span class="text-gray-700">–í–∫–ª—é—á–∏—Ç—å –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω—É—é –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å</span>
                        </label>
                        <div id="custom-duration-slider-group" class="hidden">
                            <input type="range" id="duration-slider" min="4" max="60" value="10" class="w-full">
                            <p class="text-center text-lg font-bold mt-2"><span id="duration-value">10</span> —Å–µ–∫—É–Ω–¥</p>
                        </div>
                    </div>
                </div>
                <div class="p-6 bg-white rounded-xl shadow-lg parameter-group">
                    <h3 class="text-xl font-semibold text-gray-800">–ö–∞—á–µ—Å—Ç–≤–æ/–†–∞–∑—Ä–µ—à–µ–Ω–∏–µ:</h3>
                    <div class="param-content">
                        <select id="quality" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500">
                        </select>
                        <button class="suggest-btn mt-2 w-full px-4 py-2 bg-gradient-to-r from-purple-500 to-pink-500 text-white text-sm font-semibold rounded-lg shadow-md hover:from-purple-600 hover:to-pink-600 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:ring-offset-2 transition-all duration-200" data-target="quality">ü§ñ –ü—Ä–µ–¥–ª–æ–∂–∏—Ç—å –∫–∞—á–µ—Å—Ç–≤–æ</button>
                    </div>
                </div>
                <!-- End Duration Section -->

                <!-- Parameters Section -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    
                    <!-- –°—Ç–∏–ª—å –í–∏–¥–µ–æ -->
                    <div id="style-section" class="p-6 bg-blue-100 rounded-xl shadow-lg parameter-group">
                        <div class="flex justify-between items-center mb-2">
                            <h3 class="text-xl font-semibold text-gray-800">–°—Ç–∏–ª—å –í–∏–¥–µ–æ:</h3>
                            <label class="flex items-center cursor-pointer">
                                <input type="checkbox" id="toggle-style" class="toggle-checkbox hidden" checked>
                                <span class="toggle-label"></span>
                            </label>
                        </div>
                        <div class="param-content">
                            <select id="style" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500" title="Volumetric light ‚Äî –¥–æ–±–∞–≤–ª—è–µ—Ç –≥–ª—É–±–∏–Ω—É –∏ –≤–∏–¥–∏–º—ã–µ –ª—É—á–∏ —Å–≤–µ—Ç–∞">
                              
                            </select>
                            <button class="suggest-btn mt-2 w-full px-4 py-2 bg-gradient-to-r from-purple-500 to-pink-500 text-white text-sm font-semibold rounded-lg shadow-md hover:from-purple-600 hover:to-pink-600 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:ring-offset-2 transition-all duration-200" data-target="style">ü§ñ –ü—Ä–µ–¥–ª–æ–∂–∏—Ç—å —Å—Ç–∏–ª—å</button>
                        </div>
                    </div>

                    <!-- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ê–Ω–∏–º–µ (–°–∫—Ä—ã—Ç–æ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é) -->
                    <div id="anime-options-group" class="p-6 bg-yellow-50 rounded-xl shadow-lg hidden">
                        <h3 class="text-xl font-semibold text-gray-800 mb-4">–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ê–Ω–∏–º–µ-—Å—Ç–∏–ª—è:</h3>
                        <div class="space-y-4">
                            <div>
                                <label for="anime-studio" class="block text-sm font-medium text-gray-700">–°—Ç—É–¥–∏—è/–ê–≤—Ç–æ—Ä:</label>
                                <select id="anime-studio" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500">
                                    
                                </select>
                            </div>
                            <div>
                                <label for="anime-style" class="block text-sm font-medium text-gray-700">–°—Ç–∏–ª—å –†–∏—Å–æ–≤–∫–∏/–ú–∞–Ω–≥–∏:</label>
                                <select id="anime-style" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500">
                                    
                                </select>
                            </div>
                            <div>
                                <label for="anime-artist" class="block text-sm font-medium text-gray-700">–ê—Ä—Ç–∏—Å—Ç/–ú–∞–Ω–≥–∞–∫–∞:</label>
                                <select id="anime-artist" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500">
                                    
                                </select>
                            </div>
                            <div>
                                <label for="anime-manga-input" class="block text-sm font-medium text-gray-700">–¢–∞–π—Ç–ª/–ú–∞–Ω–≥–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):</label>
                                <input type="text" id="anime-manga-input" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: Attack on Titan, One Piece">
                            </div>
                            <button id="reset-anime-btn" class="mt-4 w-full px-4 py-2 bg-yellow-500 text-white rounded-lg shadow-sm hover:bg-yellow-600 transition-colors duration-200 text-sm font-medium">–°–±—Ä–æ—Å–∏—Ç—å –∞–Ω–∏–º–µ-–ø–∞—Ä–∞–º–µ—Ç—Ä—ã</button>
                        </div>
                    </div>

                    <!-- –ü–ª–∞–Ω/–î–≤–∏–∂–µ–Ω–∏–µ –ö–∞–º–µ—Ä—ã -->
                    <div id="camera-section" class="p-6 bg-red-100 rounded-xl shadow-lg parameter-group">
                        <div class="flex justify-between items-center mb-2">
                            <h3 class="text-xl font-semibold text-gray-800">–ü–ª–∞–Ω/–î–≤–∏–∂–µ–Ω–∏–µ –ö–∞–º–µ—Ä—ã:</h3>
                            <label class="flex items-center cursor-pointer">
                                <input type="checkbox" id="toggle-camera" class="toggle-checkbox hidden" checked>
                                <span class="toggle-label"></span>
                            </label>
                        </div>
                        <div class="param-content">
                            <select id="camera" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500" title="Volumetric light ‚Äî –¥–æ–±–∞–≤–ª—è–µ—Ç –≥–ª—É–±–∏–Ω—É –∏ –≤–∏–¥–∏–º—ã–µ –ª—É—á–∏ —Å–≤–µ—Ç–∞">
                                
                            </select>
                            <button class="suggest-btn mt-2 w-full px-4 py-2 bg-gradient-to-r from-purple-500 to-pink-500 text-white text-sm font-semibold rounded-lg shadow-md hover:from-purple-600 hover:to-pink-600 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:ring-offset-2 transition-all duration-200" data-target="camera">ü§ñ –ü—Ä–µ–¥–ª–æ–∂–∏—Ç—å –¥–≤–∏–∂–µ–Ω–∏–µ –∫–∞–º–µ—Ä—ã</button>
                        </div>
                    </div>

                    <!-- –û—Å–≤–µ—â–µ–Ω–∏–µ -->
                    <div id="lighting-section" class="p-6 bg-yellow-100 rounded-xl shadow-lg parameter-group">
                        <div class="flex justify-between items-center mb-2">
                            <h3 class="text-xl font-semibold text-gray-800">–û—Å–≤–µ—â–µ–Ω–∏–µ:</h3>
                            <label class="flex items-center cursor-pointer">
                                <input type="checkbox" id="toggle-lighting" class="toggle-checkbox hidden" checked>
                                <span class="toggle-label"></span>
                            </label>
                        </div>
                        <div class="param-content">
                            <select id="lighting" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500" title="Volumetric light ‚Äî –¥–æ–±–∞–≤–ª—è–µ—Ç –≥–ª—É–±–∏–Ω—É –∏ –≤–∏–¥–∏–º—ã–µ –ª—É—á–∏ —Å–≤–µ—Ç–∞">
                                
                            </select>
                            <button class="suggest-btn mt-2 w-full px-4 py-2 bg-gradient-to-r from-purple-500 to-pink-500 text-white text-sm font-semibold rounded-lg shadow-md hover:from-purple-600 hover:to-pink-600 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:ring-offset-2 transition-all duration-200" data-target="lighting">ü§ñ –ü—Ä–µ–¥–ª–æ–∂–∏—Ç—å –æ—Å–≤–µ—â–µ–Ω–∏–µ</button>
                        </div>
                    </div>

                    <!-- –ù–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ/–≠–º–æ—Ü–∏—è -->
                    <div class="p-6 bg-white rounded-xl shadow-lg parameter-group">
                        <div class="flex justify-between items-center mb-2">
                            <h3 class="text-xl font-semibold text-gray-800">–ù–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ/–≠–º–æ—Ü–∏—è:</h3>
                            <label class="flex items-center cursor-pointer">
                                <input type="checkbox" id="toggle-mood" class="toggle-checkbox hidden" checked>
                                <span class="toggle-label"></span>
                            </label>
                        </div>
                        <div class="param-content">
                            <select id="mood" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500">
                                
                            </select>
                            <button class="suggest-btn mt-2 w-full px-4 py-2 bg-gradient-to-r from-purple-500 to-pink-500 text-white text-sm font-semibold rounded-lg shadow-md hover:from-purple-600 hover:to-pink-600 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:ring-offset-2 transition-all duration-200" data-target="mood">ü§ñ –ü—Ä–µ–¥–ª–æ–∂–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ</button>
                        </div>
                    </div>

                    <!-- –ö–∏–Ω–µ–º–∞—Ç–æ–≥—Ä–∞—Ñ–∏—è (–°–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ —Å—Ç–æ—Ä–æ–Ω) -->
                    <div class="p-6 bg-white rounded-xl shadow-lg parameter-group">
                        <div class="flex justify-between items-center mb-2">
                            <h3 class="text-xl font-semibold text-gray-800">–ö–∏–Ω–µ–º–∞—Ç–æ–≥—Ä–∞—Ñ–∏—è (–°–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ —Å—Ç–æ—Ä–æ–Ω):</h3>
                            <label class="flex items-center cursor-pointer">
                                <input type="checkbox" id="toggle-cinematography" class="toggle-checkbox hidden" checked>
                                <span class="toggle-label"></span>
                            </label>
                        </div>
                        <div class="param-content">
                            <select id="cinematography" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500">
                                
                            </select>
                            <button class="suggest-btn mt-2 w-full px-4 py-2 bg-gradient-to-r from-purple-500 to-pink-500 text-white text-sm font-semibold rounded-lg shadow-md hover:from-purple-600 hover:to-pink-600 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:ring-offset-2 transition-all duration-200" data-target="cinematography">ü§ñ –ü—Ä–µ–¥–ª–æ–∂–∏—Ç—å –∫–∏–Ω–µ–º–∞—Ç–æ–≥—Ä–∞—Ñ–∏—é</button>
                        </div>
                    </div>

                    <!-- –í–∏–∑—É–∞–ª—å–Ω—ã–µ –≠—Ñ—Ñ–µ–∫—Ç—ã -->
                    <div class="p-6 bg-white rounded-xl shadow-lg parameter-group">
                        <div class="flex justify-between items-center mb-2">
                            <h3 class="text-xl font-semibold text-gray-800">–í–∏–∑—É–∞–ª—å–Ω—ã–µ –≠—Ñ—Ñ–µ–∫—Ç—ã:</h3>
                            <label class="flex items-center cursor-pointer">
                                <input type="checkbox" id="toggle-effect" class="toggle-checkbox hidden" checked>
                                <span class="toggle-label"></span>
                            </label>
                        </div>
                        <div class="param-content">
                            <select id="effect" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500">
                                
                            </select>
                            <button class="suggest-btn mt-2 w-full px-4 py-2 bg-gradient-to-r from-purple-500 to-pink-500 text-white text-sm font-semibold rounded-lg shadow-md hover:from-purple-600 hover:to-pink-600 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:ring-offset-2 transition-all duration-200" data-target="effect">ü§ñ –ü—Ä–µ–¥–ª–æ–∂–∏—Ç—å —ç—Ñ—Ñ–µ–∫—Ç</button>
                        </div>
                    </div>

                    <!-- –ê–Ω–∏–º–∞—Ü–∏—è –§–æ—Ç–æ -->
                    <div class="p-6 bg-gradient-to-br from-purple-50 to-pink-50 rounded-xl shadow-lg parameter-group">
                        <div class="flex justify-between items-center mb-2">
                            <h3 class="text-xl font-semibold text-gray-800">–ê–Ω–∏–º–∞—Ü–∏—è –§–æ—Ç–æ (–®–∞–±–ª–æ–Ω—ã):</h3>
                            <label class="flex items-center cursor-pointer">
                                <input type="checkbox" id="toggle-photo-animation" class="toggle-checkbox hidden" checked>
                                <span class="toggle-label"></span>
                            </label>
                        </div>
                        <div class="param-content">
                            <select id="photo-animation" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500">
                                
                            </select>
                            <p class="text-xs text-gray-500 mt-2">–®–∞–±–ª–æ–Ω—ã –∞–Ω–∏–º–∞—Ü–∏–∏ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –¥–∏–Ω–∞–º–∏—á–Ω—ã—Ö –≤–∏–¥–µ–æ –∏–∑ —Å—Ç–∞—Ç–∏—á–Ω—ã—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π.</p>
                            <button class="suggest-btn mt-2 w-full px-4 py-2 bg-gradient-to-r from-purple-500 to-pink-500 text-white text-sm font-semibold rounded-lg shadow-md hover:from-purple-600 hover:to-pink-600 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:ring-offset-2 transition-all duration-200" data-target="photo-animation">ü§ñ –ü—Ä–µ–¥–ª–æ–∂–∏—Ç—å –∞–Ω–∏–º–∞—Ü–∏—é —Ñ–æ—Ç–æ</button>
                        </div>
                    </div>

                    <!-- –§–æ–Ω/–õ–æ–∫–∞—Ü–∏—è -->
                    <div class="p-6 bg-white rounded-xl shadow-lg parameter-group">
                        <div class="flex justify-between items-center mb-2">
                            <h3 class="text-xl font-semibold text-gray-800">–§–æ–Ω/–õ–æ–∫–∞—Ü–∏—è:</h3>
                            <label class="flex items-center cursor-pointer">
                                <input type="checkbox" id="toggle-background" class="toggle-checkbox hidden" checked>
                                <span class="toggle-label"></span>
                            </label>
                        </div>
                        <div class="param-content">
                            <select id="background" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500">
                                
                            </select>
                            <button class="suggest-btn mt-2 w-full px-4 py-2 bg-gradient-to-r from-purple-500 to-pink-500 text-white text-sm font-semibold rounded-lg shadow-md hover:from-purple-600 hover:to-pink-600 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:ring-offset-2 transition-all duration-200" data-target="background">ü§ñ –ü—Ä–µ–¥–ª–æ–∂–∏—Ç—å –ª–æ–∫–∞—Ü–∏—é</button>
                        </div>
                    </div>

                    <!-- –ê—É–¥–∏–æ (Veo Only) -->
                    <div id="audio-group" class="p-6 bg-white rounded-xl shadow-lg parameter-group">
                        <div class="flex justify-between items-center mb-2">
                            <h3 class="text-xl font-semibold text-gray-800">–ê—É–¥–∏–æ (Veo Only):</h3>
                            <label class="flex items-center cursor-pointer">
                                <input type="checkbox" id="toggle-audio" class="toggle-checkbox hidden" checked>
                                <span class="toggle-label"></span>
                            </label>
                        </div>
                        <div class="param-content">
                            <select id="audio" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500">
                                
                            </select>
                            <button class="suggest-btn mt-2 w-full px-4 py-2 bg-gradient-to-r from-purple-500 to-pink-500 text-white text-sm font-semibold rounded-lg shadow-md hover:from-purple-600 hover:to-pink-600 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:ring-offset-2 transition-all duration-200" data-target="audio">ü§ñ –ü—Ä–µ–¥–ª–æ–∂–∏—Ç—å –∞—É–¥–∏–æ</button>
                        </div>
                    </div>
                </div>
                <!-- End Parameters Section -->

                <!-- Advanced Parameters Section -->
                <div class="mt-8 p-6 bg-white rounded-xl shadow-lg">
                    <h3 class="text-xl font-semibold mb-4 text-gray-800">–†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã</h3>
                    <div class="space-y-4">
                        <div>
                            <label for="scene-complexity" class="block text-sm font-medium text-gray-700">–°–ª–æ–∂–Ω–æ—Å—Ç—å —Å—Ü–µ–Ω—ã: <span id="scene-complexity-value">5</span>/10</label>
                            <input type="range" id="scene-complexity" min="1" max="10" value="5" class="w-full" title="–ß–µ–º –≤—ã—à–µ –∑–Ω–∞—á–µ–Ω–∏–µ, —Ç–µ–º –±–æ–ª—å—à–µ –¥–µ—Ç–∞–ª–µ–π –∏ —Ç–µ–≥–æ–≤ –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.">
                        </div>
                        <div>
                            <label for="fog-intensity" class="block text-sm font-medium text-gray-700">–¢—É–º–∞–Ω/–î—ã–º:</label>
                            <select id="fog-intensity" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500" title="–î–æ–±–∞–≤–ª—è–µ—Ç —ç—Ñ—Ñ–µ–∫—Ç —Ç—É–º–∞–Ω–∞ –∏–ª–∏ –¥—ã–º–∞ —Ä–∞–∑–ª–∏—á–Ω–æ–π –∏–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ—Å—Ç–∏.">
                                <option value="none">–ù–µ—Ç</option>
                                <option value="slightly">–°–ª–µ–≥–∫–∞ —Ç—É–º–∞–Ω–Ω–æ</option>
                                <option value="moderately">–£–º–µ—Ä–µ–Ω–Ω–æ –¥—ã–º–Ω–æ</option>
                                <option value="extremely">–û—á–µ–Ω—å –≥—É—Å—Ç–æ–π —Ç—É–º–∞–Ω</option>
                            </select>
                        </div>
                        <div>
                            <label for="intensity-select" class="block text-sm font-medium text-gray-700">–ò–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ—Å—Ç—å:</label>
                            <select id="intensity-select" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500">
                                <option value="slightly">Slightly</option>
                                <option value="moderately" selected>Moderately</option>
                                <option value="extremely">Extremely</option>
                            </select>
                        </div>
                    </div>
                </div>
                <!-- End Advanced Parameters Section -->

                <!-- Details Section -->
                <div class="mt-8 p-6 bg-white rounded-xl shadow-lg parameter-group">
                    <div class="flex justify-between items-center mb-2">
                        <h3 class="text-xl font-semibold text-gray-800">6. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–µ—Ç–∞–ª–∏ (–¢–µ–≥–∏):</h3>
                        <label class="flex items-center cursor-pointer">
                            <input type="checkbox" id="toggle-details" class="toggle-checkbox hidden" checked>
                            <span class="toggle-label"></span>
                        </label>
                    </div>
                    <div class="param-content">
                        <textarea id="details-textarea" class="w-full min-h-[100px] p-4 border border-gray-300 rounded-lg text-base shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all" placeholder="–í–≤–µ–¥–∏—Ç–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ç–µ–≥–∏ —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é, –Ω–∞–ø—Ä–∏–º–µ—Ä: 8K, Hyperrealism, Volumetric Lighting"></textarea>
                            <div class="mt-3 flex gap-2">
                                <button id="suggest-tags-btn" class="flex-1 px-4 py-2 bg-gradient-to-r from-blue-500 to-cyan-500 text-white text-sm font-semibold rounded-lg shadow-md hover:from-blue-600 hover:to-cyan-600 transition-all duration-200">
                                    ü§ñ –ü–æ–¥–æ–±—Ä–∞—Ç—å —Ç–µ–≥–∏
                                </button>
                                <input type="number" id="details-weight" class="w-24 p-2 border border-gray-300 rounded-lg" placeholder="–í–µ—Å" step="0.1" min="0" max="2">
                            </div>
                        
                        <div class="mt-4">
                            <span class="text-sm font-semibold text-gray-600 mt-3 mb-1 block">–ö–∞—á–µ—Å—Ç–≤–æ –∏ –†–µ–Ω–¥–µ—Ä–∏–Ω–≥:</span>
                            <div class="flex flex-wrap gap-2 mt-1" id="quick-tags-quality">
                                <span class="px-3 py-1 bg-blue-50 text-blue-700 rounded-full text-xs font-medium hover:bg-blue-100 transition-colors duration-200 cursor-pointer" data-tag="8K" title="–í—ã—Å–æ–∫–æ–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ">8K</span>
                                <span class="px-3 py-1 bg-blue-50 text-blue-700 rounded-full text-xs font-medium hover:bg-blue-100 transition-colors duration-200 cursor-pointer" data-tag="4K" title="–í—ã—Å–æ–∫–æ–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ">4K</span>
                                <span class="px-3 py-1 bg-blue-50 text-blue-700 rounded-full text-xs font-medium hover:bg-blue-100 transition-colors duration-200 cursor-pointer" data-tag="Hyperrealism">–ì–∏–ø–µ—Ä—Ä–µ–∞–ª–∏–∑–º</span>
                                <span class="px-3 py-1 bg-blue-50 text-blue-700 rounded-full text-xs font-medium hover:bg-blue-100 transition-colors duration-200 cursor-pointer" data-tag="Photorealistic">–§–æ—Ç–æ—Ä–µ–∞–ª–∏–∑–º</span>
                                <span class="px-3 py-1 bg-blue-50 text-blue-700 rounded-full text-xs font-medium hover:bg-blue-100 transition-colors duration-200 cursor-pointer" data-tag="Unreal Engine 5">Unreal Engine 5</span>
                                <span class="px-3 py-1 bg-blue-50 text-blue-700 rounded-full text-xs font-medium hover:bg-blue-100 transition-colors duration-200 cursor-pointer" data-tag="Octane Render">Octane Render</span>
                                <span class="px-3 py-1 bg-blue-50 text-blue-700 rounded-full text-xs font-medium hover:bg-blue-100 transition-colors duration-200 cursor-pointer" data-tag="V-Ray">V-Ray</span>
                                <span class="px-3 py-1 bg-blue-50 text-blue-700 rounded-full text-xs font-medium hover:bg-blue-100 transition-colors duration-200 cursor-pointer" data-tag="Ray Tracing">Ray Tracing</span>
                                <span class="px-3 py-1 bg-blue-50 text-blue-700 rounded-full text-xs font-medium hover:bg-blue-100 transition-colors duration-200 cursor-pointer" data-tag="60fps">60fps</span>
                                <span class="px-3 py-1 bg-blue-50 text-blue-700 rounded-full text-xs font-medium hover:bg-blue-100 transition-colors duration-200 cursor-pointer" data-tag="120fps">120fps</span>
                                <span class="px-3 py-1 bg-blue-50 text-blue-700 rounded-full text-xs font-medium hover:bg-blue-100 transition-colors duration-200 cursor-pointer" data-tag="HDR">HDR</span>
                                <span class="px-3 py-1 bg-blue-50 text-blue-700 rounded-full text-xs font-medium hover:bg-blue-100 transition-colors duration-200 cursor-pointer" data-tag="Subsurface Scattering">Subsurface Scattering</span>
                            </div>
                            
                            <span class="text-sm font-semibold text-gray-600 mt-3 mb-1 block">–ê—Ç–º–æ—Å—Ñ–µ—Ä–∞ –∏ –≠—Ñ—Ñ–µ–∫—Ç—ã:</span>
                            <div class="flex flex-wrap gap-2 mt-1" id="quick-tags-atmosphere">
                                <span class="px-3 py-1 bg-blue-50 text-blue-700 rounded-full text-xs font-medium hover:bg-blue-100 transition-colors duration-200 cursor-pointer" data-tag="Volumetric Lighting" title="–î–æ–±–∞–≤–ª—è–µ—Ç –≥–ª—É–±–∏–Ω—É –∏ –≤–∏–¥–∏–º—ã–µ –ª—É—á–∏ —Å–≤–µ—Ç–∞">–û–±—ä–µ–º–Ω—ã–π —Å–≤–µ—Ç</span>
                                <span class="px-3 py-1 bg-blue-50 text-blue-700 rounded-full text-xs font-medium hover:bg-blue-100 transition-colors duration-200 cursor-pointer" data-tag="Cinematic Grain" title="–ò–º–∏—Ç–∏—Ä—É–µ—Ç –∑–µ—Ä–Ω–∏—Å—Ç–æ—Å—Ç—å –ø–ª–µ–Ω–∫–∏">–ö–∏–Ω–æ–∑–µ—Ä–Ω–æ</span>
                                <span class="px-3 py-1 bg-blue-50 text-blue-700 rounded-full text-xs font-medium hover:bg-blue-100 transition-colors duration-200 cursor-pointer" data-tag="Depth of Field">–ì–ª—É–±–∏–Ω–∞ —Ä–µ–∑–∫–æ—Å—Ç–∏</span>
                                <span class="px-3 py-1 bg-blue-50 text-blue-700 rounded-full text-xs font-medium hover:bg-blue-100 transition-colors duration-200 cursor-pointer" data-tag="Bokeh">–ë–æ–∫–µ</span>
                                <span class="px-3 py-1 bg-blue-50 text-blue-700 rounded-full text-xs font-medium hover:bg-blue-100 transition-colors duration-200 cursor-pointer" data-tag="Rain">–î–æ–∂–¥—å</span>
                                <span class="px-3 py-1 bg-blue-50 text-blue-700 rounded-full text-xs font-medium hover:bg-blue-100 transition-colors duration-200 cursor-pointer" data-tag="Snow">–°–Ω–µ–≥</span>
                                <span class="px-3 py-1 bg-blue-50 text-blue-700 rounded-full text-xs font-medium hover:bg-blue-100 transition-colors duration-200 cursor-pointer" data-tag="Fog">–¢—É–º–∞–Ω</span>
                                <span class="px-3 py-1 bg-blue-50 text-blue-700 rounded-full text-xs font-medium hover:bg-blue-100 transition-colors duration-200 cursor-pointer" data-tag="Dust Particles">–ß–∞—Å—Ç–∏—Ü—ã –ø—ã–ª–∏</span>
                                <span class="px-3 py-1 bg-blue-50 text-blue-700 rounded-full text-xs font-medium hover:bg-blue-100 transition-colors duration-200 cursor-pointer" data-tag="Neon Glow">–ù–µ–æ–Ω–æ–≤–æ–µ —Å–≤–µ—á–µ–Ω–∏–µ</span>
                                <span class="px-3 py-1 bg-blue-50 text-blue-700 rounded-full text-xs font-medium hover:bg-blue-100 transition-colors duration-200 cursor-pointer" data-tag="VFX">VFX</span>
                                <span class="px-3 py-1 bg-blue-50 text-blue-700 rounded-full text-xs font-medium hover:bg-blue-100 transition-colors duration-200 cursor-pointer" data-tag="Chromatic Aberration">–•—Ä–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∞–±–µ—Ä—Ä–∞—Ü–∏—è</span>
                                <span class="px-3 py-1 bg-blue-50 text-blue-700 rounded-full text-xs font-medium hover:bg-blue-100 transition-colors duration-200 cursor-pointer" data-tag="Lens Flare">–ë–ª–∏–∫</span>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- End Details Section -->

                <!-- Negative Prompt Section -->
                <div class="mt-8 p-6 bg-red-50 rounded-xl shadow-lg parameter-group" title="–í—ã–±–µ—Ä–∏—Ç–µ –≥–æ—Ç–æ–≤—ã–µ –Ω–∞–±–æ—Ä—ã –Ω–µ–≥–∞—Ç–∏–≤–Ω—ã—Ö —Ç–µ–≥–æ–≤ –¥–ª—è –∏—Å–∫–ª—é—á–µ–Ω–∏—è –Ω–µ–∂–µ–ª–∞—Ç–µ–ª—å–Ω—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤.">
                    <div class="flex justify-between items-center mb-2">
                        <h3 class="text-xl font-semibold text-red-800">7. –ù–µ–≥–∞—Ç–∏–≤–Ω—ã–π –ü—Ä–æ–º–ø—Ç (–ß—Ç–æ –∏—Å–∫–ª—é—á–∏—Ç—å):</h3>
                        <label class="flex items-center cursor-pointer">
                            <input type="checkbox" id="toggle-negative" class="toggle-checkbox hidden" checked>
                            <span class="toggle-label bg-red-500"></span>
                        </label>
                    </div>
                    <div class="param-content">
                        <div class="mb-4 space-y-2" id="negative-prompt-groups">
                            <label class="flex items-center" title="ugly, tiling, poorly drawn hands, poorly drawn feet, poorly drawn face, out of frame, extra limbs, disfigured, deformed, body out of frame, bad anatomy, watermark, signature, cut off, low contrast, underexposed, overexposed, bad art, beginner, amateur, distorted face">
                                <input type="checkbox" data-group="standard" class="form-checkbox h-5 w-5 text-red-600">
                                <span class="ml-2 text-gray-700">Standard Block (—Ä—É–∫–∏, –Ω–∏–∑–∫–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ, —Ä–∞–∑–º—ã—Ç–æ—Å—Ç—å)</span>
                            </label>
                            <label class="flex items-center" title="text, error, missing fingers, extra digit, fewer digits, cropped, worst quality, low quality, normal quality, jpeg artifacts, signature, watermark, username, blurry">
                                <input type="checkbox" data-group="anime" class="form-checkbox h-5 w-5 text-red-600">
                                <span class="ml-2 text-gray-700">Anime Block (—Ç–µ–∫—Å—Ç, –≤–æ–¥—è–Ω—ã–µ –∑–Ω–∞–∫–∏, –Ω–∏–∑–∫–∏–π —Ä–µ–π—Ç–∏–Ω–≥)</span>
                            </label>
                            <label class="flex items-center" title="two heads, ugly skin, deformed body, bad proportions, bad posture, crooked limbs, extra limbs, fused limbs, bad anatomy">
                                <input type="checkbox" data-group="realistic" class="form-checkbox h-5 w-5 text-red-600">
                                <span class="ml-2 text-gray-700">Realistic Block (–¥–≤–µ –≥–æ–ª–æ–≤—ã, —É—Ä–æ–¥–ª–∏–≤–∞—è –∫–æ–∂–∞, –¥–µ—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Ç–µ–ª–æ)</span>
                            </label>
                        </div>
                        <textarea id="negative-prompt-textarea" class="w-full min-h-[100px] p-4 border border-red-300 rounded-lg text-base shadow-sm focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-transparent transition-all" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–µ–≥–∏, –∫–æ—Ç–æ—Ä—ã–µ –Ω—É–∂–Ω–æ –∏—Å–∫–ª—é—á–∏—Ç—å, –Ω–∞–ø—Ä–∏–º–µ—Ä: low quality, blurry, watermark"></textarea>
                            <div class="mt-3 flex gap-2">
                                <button id="generate-negative-btn" class="flex-1 px-4 py-2 bg-gradient-to-r from-red-500 to-orange-500 text-white text-sm font-semibold rounded-lg shadow-md hover:from-red-600 hover:to-orange-600 transition-all duration-200">
                                    ü§ñ –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –Ω–µ–≥–∞—Ç–∏–≤
                                </button>
                                <button id="predict-problems-btn" class="flex-1 px-4 py-2 bg-gradient-to-r from-gray-600 to-gray-700 text-white text-sm font-semibold rounded-lg shadow-md hover:from-gray-700 hover:to-gray-800 transition-all duration-200">
                                    ü§ñ –ü—Ä–µ–¥—Å–∫–∞–∑–∞—Ç—å –ø—Ä–æ–±–ª–µ–º—ã
                                </button>
                                <button id="clear-negative-btn" class="flex-1 px-4 py-2 bg-gray-200 text-gray-800 text-sm font-semibold rounded-lg shadow-md hover:bg-gray-300 transition-all duration-200">
                                    –û—á–∏—Å—Ç–∏—Ç—å
                                </button>
                                <input type="number" id="negative-weight" class="w-24 p-2 border border-gray-300 rounded-lg" placeholder="–í–µ—Å" step="0.1" min="0" max="2">
                            </div>
                        
                        <div class="mt-4">
                            <span class="text-sm font-semibold text-gray-600 mt-3 mb-1 block text-red-700">–ë—ã—Å—Ç—Ä—ã–µ –Ω–µ–≥–∞—Ç–∏–≤–Ω—ã–µ —Ç–µ–≥–∏:</span>
                            <div class="flex flex-wrap gap-2 mt-1" id="negative-tags-container">
                                <span class="px-3 py-1 bg-red-50 text-red-700 rounded-full text-xs font-medium hover:bg-red-100 transition-colors duration-200 cursor-pointer" data-tag="low quality" title="–ò—Å–∫–ª—é—á–∞–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –Ω–∏–∑–∫–æ–≥–æ –∫–∞—á–µ—Å—Ç–≤–∞">–ù–∏–∑–∫–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ</span>
                                <span class="px-3 py-1 bg-red-50 text-red-700 rounded-full text-xs font-medium hover:bg-red-100 transition-colors duration-200 cursor-pointer" data-tag="blurry" title="–ò—Å–∫–ª—é—á–∞–µ—Ç —Ä–∞–∑–º—ã—Ç—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è">–†–∞–∑–º—ã—Ç–æ—Å—Ç—å</span>
                                <span class="px-3 py-1 bg-red-50 text-red-700 rounded-full text-xs font-medium hover:bg-red-100 transition-colors duration-200 cursor-pointer" data-tag="watermark">–í–æ–¥—è–Ω–æ–π –∑–Ω–∞–∫</span>
                                <span class="px-3 py-1 bg-red-50 text-red-700 rounded-full text-xs font-medium hover:bg-red-100 transition-colors duration-200 cursor-pointer" data-tag="text">–¢–µ–∫—Å—Ç</span>
                                <span class="px-3 py-1 bg-red-50 text-red-700 rounded-full text-xs font-medium hover:bg-red-100 transition-colors duration-200 cursor-pointer" data-tag="bad anatomy">–ü–ª–æ—Ö–∞—è –∞–Ω–∞—Ç–æ–º–∏—è</span>
                                <span class="px-3 py-1 bg-red-50 text-red-700 rounded-full text-xs font-medium hover:bg-red-100 transition-colors duration-200 cursor-pointer" data-tag="noise">–®—É–º</span>
                                <span class="px-3 py-1 bg-red-50 text-red-700 rounded-full text-xs font-medium hover:bg-red-100 transition-colors duration-200 cursor-pointer" data-tag="artifacts">–ê—Ä—Ç–µ—Ñ–∞–∫—Ç—ã</span>
                                <span class="px-3 py-1 bg-red-50 text-red-700 rounded-full text-xs font-medium hover:bg-red-100 transition-colors duration-200 cursor-pointer" data-tag="ugly">–£—Ä–æ–¥–ª–∏–≤—ã–π</span>
                                <span class="px-3 py-1 bg-red-50 text-red-700 rounded-full text-xs font-medium hover:bg-red-100 transition-colors duration-200 cursor-pointer" data-tag="disfigured">–ò–∑—É—Ä–æ–¥–æ–≤–∞–Ω–Ω—ã–π</span>
                                <span class="px-3 py-1 bg-red-50 text-red-700 rounded-full text-xs font-medium hover:bg-red-100 transition-colors duration-200 cursor-pointer" data-tag="oversaturated">–ü–µ—Ä–µ–Ω–∞—Å—ã—â–µ–Ω–Ω—ã–π</span>
                                <span class="px-3 py-1 bg-red-50 text-red-700 rounded-full text-xs font-medium hover:bg-red-100 transition-colors duration-200 cursor-pointer" data-tag="monochrome">–ú–æ–Ω–æ—Ö—Ä–æ–º–Ω—ã–π</span>
                                <span class="px-3 py-1 bg-red-50 text-red-700 rounded-full text-xs font-medium hover:bg-red-100 transition-colors duration-200 cursor-pointer" data-tag="cartoon">–ú—É–ª—å—Ç—è—à–Ω—ã–π</span>
                                <span class="px-3 py-1 bg-red-50 text-red-700 rounded-full text-xs font-medium hover:bg-red-100 transition-colors duration-200 cursor-pointer" data-tag="cropped">–û–±—Ä–µ–∑–∞–Ω–Ω—ã–π</span>
                                <span class="px-3 py-1 bg-red-50 text-red-700 rounded-full text-xs font-medium hover:bg-red-100 transition-colors duration-200 cursor-pointer" data-tag="duplicate">–î—É–±–ª–∏–∫–∞—Ç</span>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- End Negative Prompt Section -->

                <!-- Control Buttons -->
                <div class="mt-8 flex flex-wrap gap-3 justify-center">
                    <button id="reset-params-btn" class="px-6 py-3 bg-gray-200 text-gray-800 font-semibold rounded-lg shadow-md hover:bg-gray-300 transition-all duration-200 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg>
                        –°–±—Ä–æ—Å–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
                    </button>
                    <button id="random-prompt-btn" class="px-6 py-3 bg-purple-500 text-white font-semibold rounded-lg shadow-md hover:bg-purple-600 transition-all duration-200 flex items-center" title="–ì–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —Å–ª—É—á–∞–π–Ω—É—é '–ò–¥–µ—é' –∏ –Ω–∞–±–æ—Ä '–î–µ—Ç–∞–ª–µ–π' –¥–ª—è —Ç–≤–æ—Ä—á–µ—Å–∫–æ–≥–æ –ø–æ–∏—Å–∫–∞.">
                        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 18h.01M8 21h8a2 2 0 002-2V5a2 2 0 00-2-2H8a2 2 0 00-2 2v14a2 2 0 002 2z"></path></svg>
                        –ú–Ω–µ –ø–æ–≤–µ–∑–µ—Ç!
                    </button>
                </div>
                <!-- End Control Buttons -->

                <!-- Result Section -->
                <div id="result-section" class="mt-12 p-6 bg-white rounded-xl shadow-2xl hidden">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-2xl font-bold text-blue-600">8. –ì–æ—Ç–æ–≤—ã–π –ü—Ä–æ–º–ø—Ç:</h3>
                        <div>
                            <label for="output-format" class="text-sm font-medium text-gray-700">–§–æ—Ä–º–∞—Ç –≤—ã–≤–æ–¥–∞:</label>
                            <select id="output-format" class="p-2 border border-gray-300 rounded-lg">
                                <option value="comma">–ß–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é</option>
                                <option value="bullet">–°–ø–∏—Å–æ–∫</option>
                                <option value="flags">–§–ª–∞–≥–∏</option>
                            </select>
                        </div>
                    </div>
                    <div id="prompt-output-container" class="w-full min-h-[300px] p-4 border-2 border-blue-300 rounded-lg text-base bg-gray-50 font-mono resize-none overflow-auto">
                        <div id="prompt-output"></div>
                    </div>
                    <!-- Prompt Quality Score Panel -->
                    <div id="quality-panel" class="mt-6 p-6 bg-gradient-to-r from-green-50 to-blue-50 rounded-xl shadow-lg hidden">
                        <h3 class="text-lg font-semibold text-gray-800 mb-3">üìä –û—Ü–µ–Ω–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞ –ø—Ä–æ–º–ø—Ç–∞</h3>
                        <div class="flex items-center mb-4">
                            <div class="flex-1">
                                <div class="w-full bg-gray-200 rounded-full h-4">
                                    <div id="quality-bar" class="bg-gradient-to-r from-green-400 to-green-600 h-4 rounded-full transition-all duration-500" style="width: 0%"></div>
                                </div>
                            </div>
                            <span id="quality-score" class="ml-4 text-3xl font-bold text-green-600">0</span>
                        </div>
                        <div id="quality-feedback" class="text-sm text-gray-700 space-y-2">
                            <!-- Feedback will be inserted here -->
                        </div>
                    </div>
                    <!-- Storyboard Preview Panel -->
                    <div id="storyboard-panel" class="mt-6 p-6 bg-gradient-to-r from-purple-50 to-pink-50 rounded-xl shadow-lg hidden">
                        <h3 class="text-lg font-semibold text-gray-800 mb-3">üé¨ –ü—Ä–µ–≤—å—é —Å—Ç–æ—Ä–∏–±–æ—Ä–¥–∞</h3>
                        <div id="storyboard-scenes" class="space-y-3">
                            <!-- Scenes will be inserted here -->
                        </div>
                    </div>
                    
                    <div class="flex flex-wrap gap-3 mt-4">
                        <button id="copy-btn" class="px-6 py-3 bg-blue-600 text-white font-semibold rounded-lg shadow-md hover:bg-blue-700 transition-all duration-200 flex items-center">
                            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1M8 5a2 2 0 002 2h2a2 2 0 002-2M8 5a2 2 0 012-2h2a2 2 0 012 2m0 0h2a2 2 0 012 2v3m-7 4l-3 3m0 0l3 3m-3-3h10"></path></svg>
                            –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å
                        </button>
                        <button id="add-to-favorites-btn" class="px-6 py-3 bg-yellow-500 text-white font-semibold rounded-lg shadow-md hover:bg-yellow-600 transition-all duration-200 flex items-center">
                            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 5a2 2 0 012-2h10a2 2 0 012 2v1h-14v-1zM5 8h14v10a2 2 0 01-2 2H7a2 2 0 01-2-2V8z"></path></svg>
                            –í –∏–∑–±—Ä–∞–Ω–Ω–æ–µ
                        </button>
                        <button id="edit-btn" class="px-6 py-3 bg-gray-100 text-gray-700 font-semibold rounded-lg shadow-md hover:bg-gray-200 transition-all duration-200 flex items-center">
                            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"></path></svg>
                            –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
                        </button>
                        <button id="regenerate-btn" class="px-6 py-3 bg-yellow-500 text-white font-semibold rounded-lg shadow-md hover:bg-yellow-600 transition-all duration-200 flex items-center">
                            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg>
                            –ü–µ—Ä–µ–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å
                        </button>
                        <button id="export-btn" class="px-6 py-3 bg-indigo-600 text-white font-semibold rounded-lg shadow-md hover:bg-indigo-700 transition-all duration-200 flex items-center">
                            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path></svg>
                            –≠–∫—Å–ø–æ—Ä—Ç (.txt)
                        </button>
                    </div>
                </div>
                <!-- End Result Section -->

                <!-- Real-time Prompt Visualization -->
                <div class="mt-8 p-6 bg-gray-50 rounded-xl shadow-inner">
                    <h3 class="text-xl font-semibold mb-4 text-gray-700">–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –ü—Ä–æ–º–ø—Ç–∞</h3>
                    <div id="prompt-visualization" class="p-4 bg-white rounded-lg border border-gray-200 text-sm font-mono"></div>
                </div>
                <!-- End Real-time Prompt Visualization -->

                <!-- History and Favorites Section -->
                <div id="history-favorites-section" class="mt-12 p-6 bg-white rounded-xl shadow-lg">
                    <h3 class="text-2xl font-bold mb-4 text-gray-800">–ò—Å—Ç–æ—Ä–∏—è –∏ –ò–∑–±—Ä–∞–Ω–Ω–æ–µ</h3>
                    <div class="border-b border-gray-200">
                        <nav class="-mb-px flex space-x-8" aria-label="Tabs">
                            <button id="history-tab" class="whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm text-blue-600 border-blue-600">
                                –ò—Å—Ç–æ—Ä–∏—è
                            </button>
                            <button id="favorites-tab" class="whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm text-gray-500 hover:text-gray-700 hover:border-gray-300">
                                –ò–∑–±—Ä–∞–Ω–Ω–æ–µ
                            </button>
                        </nav>
                    </div>
                    <div id="history-list" class="mt-4 space-y-3">
                        <!-- History items will be injected here -->
                    </div>
                    <div id="favorites-list" class="mt-4 space-y-3 hidden">
                        <!-- Favorites items will be injected here -->
                    </div>
                </div>
                <!-- End History and Favorites Section -->

            </div>
        </section>
    </main>

    <div id="notification-container" class="fixed bottom-4 right-4 z-50 flex flex-col items-end space-y-2">
        <!-- Notifications will appear here -->
    </div>

    <button id="scroll-to-top" class="hidden fixed bottom-4 right-4 p-3 bg-blue-600 text-white rounded-full shadow-lg hover:bg-blue-700 transition-all duration-300 z-50">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 15l7-7 7 7" />
        </svg>
    </button>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            
            // --- Populating dropdowns from data.js ---
            function populateDropdowns() {
                // The id attribute of each <select> element in HTML must match a key in the dropdownData object.
                for (const dropdownId in dropdownData) {
                    const selectElement = document.getElementById(dropdownId);
                    if (selectElement) {
                        const optionsData = dropdownData[dropdownId];
                        selectElement.innerHTML = ''; // Clear existing options to prevent duplicates if script runs again
                        for (const value in optionsData) {
                            const option = document.createElement('option');
                            option.value = value;
                            option.textContent = optionsData[value];
                            selectElement.appendChild(option);
                        }
                    } else {
                        // This warning helps catch mismatches between data.js keys and HTML IDs.
                        console.warn(`Dropdown element with id '${dropdownId}' not found in the HTML.`);
                    }
                }
            }
            // Populate dropdowns on page load.
            populateDropdowns();
            // --- End of dropdown population ---
            const STORAGE_KEY = 'aiPromptCreatorStateV11';
            let undoState = null; // –î–ª—è —Ñ—É–Ω–∫—Ü–∏–∏ "–û—Ç–º–µ–Ω–∏—Ç—å —Å–±—Ä–æ—Å"

            // --- –≠–ª–µ–º–µ–Ω—Ç—ã DOM ---
            const subjectInput = document.getElementById('subject-input');
            const styleLightingInput = document.getElementById('style-lighting-input');
            const qualityResolutionInput = document.getElementById('quality-resolution-input');
            const improveBtn = document.getElementById('improve-btn');
            const superImproveBtn = document.getElementById('super-improve-btn');
            const resetParamsBtn = document.getElementById('reset-params-btn');
            const randomPromptBtn = document.getElementById('random-prompt-btn');
            const promptOutput = document.getElementById('prompt-output');
            const copyBtn = document.getElementById('copy-btn');
            const editBtn = document.getElementById('edit-btn');
            const regenerateBtn = document.getElementById('regenerate-btn');
            const exportBtn = document.getElementById('export-btn');
            const resultSection = document.getElementById('result-section');
            const notificationContainer = document.getElementById('notification-container');
            const durationSlider = document.getElementById('duration-slider');
            const durationValue = document.getElementById('duration-value');
            const durationButtons = document.querySelectorAll('.duration-btn');
            const customDurationToggle = document.getElementById('custom-duration-toggle');
            const customDurationSliderGroup = document.getElementById('custom-duration-slider-group');
            const modelRadios = document.querySelectorAll('input[name="model"]');
            const enableModelSelectionCheckbox = document.getElementById('enable-model-selection');
            const modelSelectionContainer = document.getElementById('model-selection-container');
            const audioGroup = document.getElementById('audio-group');
            const styleSelect = document.getElementById('style');
            const animeOptionsGroup = document.getElementById('anime-options-group');
            const animeStudioSelect = document.getElementById('anime-studio');
            const animeStyleSelect = document.getElementById('anime-style');
            const animeMangaInput = document.getElementById('anime-manga-input');
            const presetButtons = document.querySelectorAll('.preset-btn');
            const detailsTextarea = document.getElementById('details-textarea');
            const negativePromptTextarea = document.getElementById('negative-prompt-textarea');
            const quickTagContainers = document.querySelectorAll('#quick-tags-quality, #quick-tags-atmosphere');
            const negativeTagContainer = document.getElementById('negative-tags-container');
            const toggleCheckboxes = document.querySelectorAll('.toggle-checkbox');
            const parameterGroups = document.querySelectorAll('.parameter-group');
            const detailLevelButtons = document.querySelectorAll('.detail-level-btn');
            const scrollToTopBtn = document.getElementById('scroll-to-top');
            const createPresetBtn = document.getElementById('create-preset-btn');
            const customPresetsContainer = document.getElementById('custom-presets-container');
            const resetAnimeBtn = document.getElementById('reset-anime-btn');
            const operatingModeSelect = document.getElementById('operating-mode');
            const translateToEnglishBtn = document.getElementById('translate-to-english-btn');
            const generateIdeasBtn = document.getElementById('generate-ideas-btn');
            const generateIdeasStyleBtn = document.getElementById('generate-ideas-style-btn');
            const generateIdeasQualityBtn = document.getElementById('generate-ideas-quality-btn');
            const historyTab = document.getElementById('history-tab');
            const favoritesTab = document.getElementById('favorites-tab');
            const historyList = document.getElementById('history-list');
            const favoritesList = document.getElementById('favorites-list');
            const addToFavoritesBtn = document.getElementById('add-to-favorites-btn');
            const generateCustomPresetBtn = document.getElementById('generate-custom-preset-btn');

            const HISTORY_KEY = 'aiPromptCreatorHistoryV11';
            const FAVORITES_KEY = 'aiPromptCreatorFavoritesV11';
            const sceneComplexitySlider = document.getElementById('scene-complexity');
            const sceneComplexityValue = document.getElementById('scene-complexity-value');
            const fogIntensitySelect = document.getElementById('fog-intensity');
            const clearNegativeBtn = document.getElementById('clear-negative-btn');
            const promptVisualization = document.getElementById('prompt-visualization');
            const presetFilter = document.getElementById('preset-filter');
            const presetSort = document.getElementById('preset-sort');
            const darkModeToggle = document.getElementById('dark-mode-toggle');
            const noNamesOptions = document.getElementById('no-names-options');
            const outputFormat = document.getElementById('output-format');
            const base64Options = document.getElementById('base64-options');



            const presets = {
                'cinematic-epic': {
                    style: 'realistic', camera: 'wide-shot', lighting: 'cinematic', cinematography: '21:9', mood: 'epic', effect: 'film-grain', background: 'nature-forest', audio: 'epic-music', details: '8K, Hyperrealism, Volumetric Lighting, Cinematic Grain, Epic Scale', negative: 'low quality, blurry, artifacts, watermark'
                },
                'cyberpunk-neon': {
                    style: 'futuristic', camera: 'dutch-angle', lighting: 'neon', cinematography: '16:9', mood: 'tense', effect: 'glitch', background: 'cyberpunk-street', audio: 'synthwave-music', details: 'High contrast, Rain, Wet Ground, Glitch Effect, Neon reflections, Ray Tracing', negative: 'low quality, blurry, text, bad anatomy, warm colors'
                },
                'pixar-animation': {
                    style: 'animation-3d', camera: 'medium-shot', lighting: 'soft', cinematography: '16:9', mood: 'joyful', effect: 'depth-of-field', background: 'abstract-geometric', audio: 'lo-fi-music', details: 'Bright colors, Smooth movement, Cartoon style, Depth of Field, 60fps, Subsurface Scattering', negative: 'realistic, film grain, dark, scary, noise'
                },
                'documentary-nature': {
                    style: 'documentary', camera: 'tracking', lighting: 'natural', cinematography: '16:9', mood: 'calm', effect: 'none', background: 'nature-forest', audio: 'nature-sounds', details: 'Handheld camera, Shallow depth of field, Photorealistic, 60fps, 8K, High Dynamic Range', negative: 'vfx, stylized, cartoon, low quality, distortion'
                },
                'low-key-noir': {
                    style: 'noir', camera: 'low-angle', lighting: 'low-key', cinematography: '2.35:1', mood: 'gloomy', effect: 'smoke-fog', background: 'rainy-alley', audio: 'jazz', details: 'Black and white, High contrast, Hard shadows, Film Noir style, Wet surfaces', negative: 'color, high key, bright, happy, soft lighting'
                },
                'vintage-vhs': {
                    style: 'vintage', camera: 'pan-left', lighting: 'backlight', cinematography: '4:3', mood: 'nostalgic', effect: 'vhs', background: 'suburban-street', audio: 'synth-pop', details: 'VHS effect, Tracking lines, Low resolution, Grainy, 80s aesthetic, Scanlines', negative: 'high quality, 4k, clean, modern, sharp'
                },
                'fantasy-magic': {
                    style: 'fantasy', camera: 'crane-shot', lighting: 'magic-glow', cinematography: '21:9', mood: 'magical', effect: 'god-rays', background: 'historical-castle', audio: 'orchestral-strings', details: 'Magic particles, God Rays, High fantasy, Detailed armor, Unreal Engine 5, Bloom', negative: 'low quality, modern, sci-fi, blurry, noise'
                },
                'wes-anderson': {
                    style: 'stop-motion', camera: 'medium-shot', lighting: 'soft', cinematography: '4:3', mood: 'whimsical', effect: 'tilt-shift', background: 'medieval-village', audio: 'folk', details: 'Symmetry, Pastel colors, Flat composition, Stop motion animation, Tilt-Shift, Soft Lighting', negative: 'dark, realistic, high contrast, glitch, aggressive'
                },
                'post-apocalypse': {
                    style: 'realistic', camera: 'handheld', lighting: 'dramatic', cinematography: '16:9', mood: 'dystopian', effect: 'smoke-fog', background: 'post-apocalyptic-wasteland', audio: 'ambient', details: 'Dust, Ruined city, Handheld camera, Cinematic grain, HDR, Low Exposure', negative: 'clean, bright, joyful, low quality, vibrant colors'
                },
                'anime-ghibli': {
                    style: 'anime', camera: 'tracking', lighting: 'soft', cinematography: '16:9', mood: 'peaceful', effect: 'none', background: 'japanese-garden', audio: 'japanese-flute', details: 'Studio Ghibli style, Traditional Hand-Drawn, Warm colors, Detailed nature, Soft Lighting', negative: 'low quality, glitch, hard shadows, mecha',
                    studio: 'Studio Ghibli', animeStyle: 'Traditional Hand-Drawn'
                },
                'manga-style': {
                    style: 'anime', camera: 'close-up', lighting: 'low-key', cinematography: '4:3', mood: 'tense', effect: 'film-grain', background: 'classroom', audio: 'silence', details: 'Manga Style, Black and white, High contrast, Shonen Manga style, Ink lines', negative: 'color, soft lighting, blur, low quality',
                    animeStyle: 'Manga Style'
                },
                'lovecraft-horror': {
                    style: 'noir', camera: 'low-angle', lighting: 'low-key', cinematography: '16:9', mood: 'ominous', effect: 'smoke-fog', background: 'ancient-ruins', audio: 'horror-score', details: 'Cosmic horror, Tentacles, Eldritch symbols, High contrast, Dramatic shadows, Film grain', negative: 'bright, colorful, happy, cute, anime'
                },
                'sci-fi-retro': {
                    style: 'vintage', camera: 'pan-left', lighting: 'fluorescent', cinematography: '4:3', mood: 'futuristic', effect: 'vhs', background: 'space-station', audio: 'synthwave-music', details: '70s sci-fi aesthetic, Retro futurism, Analog technology, Lens flare, Chromatic aberration, Grainy film', negative: 'modern, sleek, digital, 4k, clean'
                },
                'romantic-scene': {
                    style: 'realistic', camera: 'close-up', lighting: 'sunset', cinematography: '21:9', mood: 'romantic', effect: 'bokeh', background: 'beach-ocean', audio: 'acoustic-guitar', details: 'Golden hour, Soft focus, Bokeh, Lens flare, Emotional, Warm colors, Shallow depth of field', negative: 'dark, horror, tense, sad, ugly'
                },
                '3d-modeling': {
                    style: 'animation-3d', camera: 'medium-shot', lighting: 'studio-light', cinematography: '16:9', mood: 'futuristic', effect: 'none', background: 'abstract-geometric', audio: 'electronic-trance', details: 'octane render, unreal engine 5, high poly, smooth shading', negative: 'low quality, blurry, 2d, drawing'
                },
                'cinematic-noir': {
                    style: 'noir', camera: 'low-angle', lighting: 'cinematic', cinematography: '21:9', mood: 'mysterious', effect: 'smoke-fog', background: 'rainy-alley', audio: 'jazz', details: 'cinematic light, volumetric light, rim lighting, low key, shadowplay, contrast', negative: 'color, bright, happy, soft lighting'
                },
                'cel-shaded-comic': {
                    style: 'comic-book', camera: 'dutch-angle', lighting: 'hard', cinematography: '16:9', mood: 'action', effect: 'none', background: 'urban-city', audio: 'rock', details: 'cel-shaded, comic book style, ink lines, vibrant colors, halftone effect', negative: 'realistic, photorealistic, soft shading, blurry'
                },
                'street-photography': {
                    style: 'realistic', camera: 'handheld', lighting: 'natural', cinematography: '4:3', mood: 'nostalgic', effect: 'film-grain', background: 'urban-city', audio: 'ambient', details: 'Fujifilm X-T4, 35mm lens, candid shot, grainy photo, shallow depth of field', negative: 'vfx, stylized, cartoon, low quality, studio lighting'
                },
                'steampunk': {
                    style: 'steampunk', camera: 'medium-shot', lighting: 'warm', cinematography: '16:9', mood: 'historical', effect: 'smoke-fog', background: 'abandoned-factory', audio: 'ambient', details: 'steampunk aesthetic, brass, gears, cogs, Victorian era, goggles', negative: 'modern, futuristic, plastic, minimalist'
                },
                'ai-art': {
                    style: 'abstract', camera: 'dolly-zoom', lighting: 'neon', cinematography: '16:9', mood: 'surreal', effect: 'glitch', background: 'abstract-geometric', audio: 'electronic-trance', details: 'neural network style, generative art, abstract patterns, vibrant colors, flowing textures', negative: 'realistic, photorealistic, human figures, symmetrical'
                },
                'hyper-realistic-macro': {
                    style: 'hyperrealism', camera: 'macro-shot', lighting: 'soft', cinematography: '1:1', mood: 'calm', effect: 'depth-of-field', background: 'nature-forest', audio: 'ambient', details: 'extreme close-up, highly detailed textures, shallow depth of field, 8K, photorealistic', negative: 'blurry, out of focus, wide shot, cartoon'
                },
                'glitchcore-vaporwave': {
                    style: 'glitch-art', camera: 'dutch-angle', lighting: 'neon', cinematography: '4:3', mood: 'nostalgic', effect: 'vhs', background: 'urban-city', audio: 'synthwave-music', details: 'glitch effects, datamoshing, VHS static, pink and blue neon, retro computer graphics, vaporwave aesthetic', negative: 'clean, modern, high-definition, smooth, natural colors'
                },
                'stop-motion-claymation': {
                    style: 'claymation', camera: 'medium-shot', lighting: 'studio-light', cinematography: '4:3', mood: 'whimsical', effect: 'stop-motion', background: 'abstract-geometric', audio: 'folk', details: 'plasticine characters, handcrafted feel, slight imperfections, tangible textures, stop motion animation', negative: 'realistic, CGI, smooth animation, hyperdetailed'
                }
            };
            // --- –ö–æ–Ω–µ—Ü —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã—Ö –∫–∞—Ä—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ ---

            // --- –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ ---

            function getRandomOption(selectElement) {
                const options = selectElement.getElementsByTagName('option');
                const randomIndex = Math.floor(Math.random() * options.length);
                return options[randomIndex].value;
            }

            function toggleAudioSelector() {
                const isModelSelectionEnabled = enableModelSelectionCheckbox.checked;
                
                if (!isModelSelectionEnabled) {
                    // –ï—Å–ª–∏ –≤—ã–±–æ—Ä –º–æ–¥–µ–ª–∏ –æ—Ç–∫–ª—é—á–µ–Ω, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏
                    audioGroup.style.display = 'block';
                } else {
                    // –ï—Å–ª–∏ –≤—ã–±–æ—Ä –º–æ–¥–µ–ª–∏ –≤–∫–ª—é—á–µ–Ω, –ø—Ä–æ–≤–µ—Ä—è–µ–º –≤—ã–±—Ä–∞–Ω–Ω—É—é –º–æ–¥–µ–ª—å
                    const selectedModel = document.querySelector('input[name="model"]:checked').value;
                    if (selectedModel === 'veo') {
                        audioGroup.style.display = 'block';
                    } else {
                        audioGroup.style.display = 'none';
                    }
                }
                saveState();
            }

            async function generateCustomPreset() {
                const idea = subjectInput.value.trim();
                if (!idea) {
                    showNotification('Please enter an idea to generate a preset.', 'warning');
                    return;
                }

                try {
                    const response = await fetch('http://localhost:3000/api/generate-custom-preset', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            idea: idea,
                            generationModel: document.querySelector('input[name="generation-model"]:checked').value
                        })
                    });
                    const preset = await response.json();

                    // Apply the generated preset
                    styleSelect.value = preset.style;
                    document.getElementById('camera').value = preset.camera;
                    document.getElementById('lighting').value = preset.lighting;
                    document.getElementById('cinematography').value = preset.cinematography;
                    document.getElementById('mood').value = preset.mood;
                    document.getElementById('effect').value = preset.effect;
                    document.getElementById('background').value = preset.background;
                    document.getElementById('audio').value = preset.audio;
                    detailsTextarea.value = preset.details;
                    negativePromptTextarea.value = preset.negative;

                    showNotification('AI-generated preset applied!', 'success');
                    saveState();

                } catch (error) {
                    showNotification('Error generating custom preset.', 'error');
                }
            }

            function formatPromptOutput(prompt, format = 'comma') {
                const parts = prompt.split(',').map(p => p.trim()).filter(Boolean);
                switch (format) {
                    case 'bullet':
                        return parts.map(part => `- ${part}`).join('\n');
                    case 'flags':
                        return parts.map(part => {
                            if (part.includes(':')) {
                                const [key, value] = part.split(':');
                                return `--${key.trim().replace(/\s+/g, '-')} ${value.trim()}`;
                            }
                            return part;
                        }).join(' ');
                    default:
                        return prompt;
                }
            }
            
            function toggleModelSelection() {
                const isEnabled = enableModelSelectionCheckbox.checked;
                
                if (isEnabled) {
                    modelSelectionContainer.style.display = 'grid';
                } else {
                    modelSelectionContainer.style.display = 'none';
                }
                
                toggleAudioSelector();
                saveState();
            }

            function toggleAnimeOptions() {
                if (styleSelect.value === 'anime') {
                    animeOptionsGroup.classList.remove('hidden');
                } else {
                    animeOptionsGroup.classList.add('hidden');
                }
                saveState();
            }

            function toggleParameterGroup(event) {
                const checkbox = event.currentTarget;
                const group = checkbox.closest('.parameter-group');
                const content = group.querySelector('.param-content');
                
                if (checkbox.checked) {
                    content.style.display = 'block';
                    group.classList.remove('opacity-50');
                } else {
                    content.style.display = 'none';
                    group.classList.add('opacity-50');
                }
                saveState();
            }

            function getParameterValue(id) {
                const select = document.getElementById(id);
                // Fix for elements that are not in a collapsible group, like 'quality'
                const group = select.closest('.parameter-group');
                if (group) {
                    const toggle = group.querySelector(`#toggle-${id}`);
                    if (toggle && !toggle.checked) {
                        return null; // Parameter is disabled
                    }
                }
                
                // Return the direct value from the select element
                return select.value;
            }
// !!! –í–û–¢ –ù–û–í–ê–Ø –§–£–ù–ö–¶–ò–Ø, –ö–û–¢–û–†–£–Æ –ú–´ –î–û–ë–ê–í–ò–õ–ò !!!
            function collectAllParameters() {
                const selectedModel = document.querySelector('input[name="model"]:checked').value;
                const intensitySelect = document.getElementById('intensity-select');
                
                const parameters = {
                    sceneComplexity: sceneComplexitySlider.value,
                    fogIntensity: fogIntensitySelect.value,
                    intensityLevels: intensitySelect.value,
                    style: getParameterValue('style'),
                    camera: getParameterValue('camera'),
                    lighting: getParameterValue('lighting'),
                    cinematography: getParameterValue('cinematography'),
                    mood: getParameterValue('mood'),
                    effect: getParameterValue('effect'),
                    photoAnimation: getParameterValue('photo-animation'),
                    background: getParameterValue('background'),
                    duration: document.getElementById('toggle-duration').checked ? durationValue.textContent : null,
                    
                    audio: (enableModelSelectionCheckbox.checked === false || selectedModel === 'veo') && document.getElementById('toggle-audio').checked 
                           ? document.getElementById('audio').value
                           : null,
                           
                    details: document.getElementById('toggle-details').checked ? detailsTextarea.value.trim() : null,
                    negative: document.getElementById('toggle-negative').checked ? negativePromptTextarea.value.trim() : null,
                    generationModel: document.querySelector('input[name="generation-model"]:checked').value
                };
                
                if (styleSelect.value === 'anime' && document.getElementById('toggle-style').checked) {
                    const studio = animeStudioSelect.value;
                    const animeStyle = animeStyleSelect.value;
                    const manga = animeMangaInput.value.trim();

                    if (studio) parameters.animeStudio = studio;
                    if (animeStyle) parameters.animeStyle = animeStyle;
                    if (manga) parameters.animeManga = manga;
                }
                parameters.quality = getParameterValue('quality');
                parameters.animeArtist = getParameterValue('anime-artist');

                return parameters;
            }


            // !!! –í–û–¢ –ò–ó–ú–ï–ù–ï–ù–ù–ê–Ø –§–£–ù–ö–¶–ò–Ø (–ó–ê–ú–ï–ù–ê –°–¢–ê–†–û–ô) !!!
            // --- –ï–¥–∏–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ø—Ä–æ–º–ø—Ç–∞ (DRY) ---
            async function generatePrompt(isSuperImprove = false, mode = null) { // –î–æ–±–∞–≤–ª—è–µ–º 'async'
                const idea = [subjectInput.value.trim(), styleLightingInput.value.trim(), qualityResolutionInput.value.trim()].filter(Boolean).join(', ');
                if (!idea) {
                    showNotification('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –≤–∞—à—É –∏–¥–µ—é –¥–ª—è –≤–∏–¥–µ–æ.', 'warning');
                    return;
                }
                saveToHistory();
                const btn = isSuperImprove ? superImproveBtn : improveBtn;
                const originalBtnText = btn.innerHTML;
                const otherBtn = isSuperImprove ? improveBtn : superImproveBtn;

                // --- UI: –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–ø–∏–Ω–Ω–µ—Ä ---
                btn.innerHTML = `
                    <svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-white" ...>
                       ... (–∫–æ–¥ –∏–∫–æ–Ω–∫–∏) ...
                    </svg>
                    ${isSuperImprove ? '–û–±—Ä–∞–±–æ—Ç–∫–∞ Gemini...' : '–û–±—Ä–∞–±–æ—Ç–∫–∞ Gemini...'}
                `;
                btn.disabled = true;
                otherBtn.disabled = true;
                
                // === –ù–ê–ß–ê–õ–û –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø ===

                // 1. –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ä–µ–∂–∏–º API –Ω–∞ –æ—Å–Ω–æ–≤–µ –Ω–∞–∂–∞—Ç–æ–π –∫–Ω–æ–ø–∫–∏
                let apiMode;
                if (mode === 'auto-pilot') {
                    apiMode = 'auto-pilot';
                } else if (isSuperImprove) {
                    apiMode = 'super-improve';
                } else {
                    apiMode = 'improve';
                }

                // 2. –ü–æ–ª—É—á–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ "–†–µ–∂–∏–º–∞ –†–∞–±–æ—Ç—ã" –∏–∑ –≤—ã–ø–∞–¥–∞—é—â–µ–≥–æ —Å–ø–∏—Å–∫–∞
                const operatingMode = operatingModeSelect.value;

                // === –ö–û–ù–ï–¶ –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø ===

                // --- –ù–û–í–´–ô –ö–û–î API ---
                
                // 1. –°–±–æ—Ä –≤—Å–µ—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
                const parameters = collectAllParameters(); // –í—ã–∑–æ–≤ –Ω–æ–≤–æ–π –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏

                // 2. –ê–¥—Ä–µ—Å –≤–∞—à–µ–≥–æ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞
                const backendUrl = 'http://localhost:3000/api/generate-prompt'; 

                try {
                    // 3. –û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ –Ω–∞ –≤–∞—à —Å–µ—Ä–≤–µ—Ä
                    const body = {
                        idea: idea,
                        parameters: parameters,
                        mode: apiMode,
                        operatingMode: operatingMode
                    };

                    if (operatingMode === 'no-names') {
                        body.noNamesAutoAnalyze = document.getElementById('no-names-auto-analyze').checked;
                        body.noNamesExceptions = document.getElementById('no-names-exceptions').value.trim();
                    } else if (operatingMode === 'base64') {
                        body.base64Encoding = document.getElementById('base64-encoding').value;
                    }

                    const response = await fetch(backendUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(body)
                    });

                    // 4. –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–≤–µ—Ç–∞
                    if (!response.ok) {
                        const errorData = await response.json();
                        throw new Error(errorData.error || `–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞: ${response.status}`);
                    }

                    const data = await response.json();
                    
                    // 5. –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –æ—Ç Gemini
                    let finalPrompt = data.generatedPrompt;
                    currentRawPrompt = finalPrompt;
                    updatePromptOutput();
                    resultSection.style.display = 'block';
                    
                    showNotification(isSuperImprove ? '–ü—Ä–æ–º–ø—Ç —Å–æ–∑–¥–∞–Ω —á–µ—Ä–µ–∑ Gemini!' : '–ü—Ä–æ–º–ø—Ç —Å–æ–∑–¥–∞–Ω —á–µ—Ä–µ–∑ Gemini!', 'success');
                    resultSection.scrollIntoView({ behavior: 'smooth', block: 'start' });

                } catch (error) {
                    console.error('API Request Failed:', error);
                    // –ü–æ–ª–µ–∑–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ, –µ—Å–ª–∏ —Å–µ—Ä–≤–µ—Ä –Ω–µ –∑–∞–ø—É—â–µ–Ω
                    if (error.message.includes('Failed to fetch')) {
                        showNotification('–û—à–∏–±–∫–∞: –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ —Å–µ—Ä–≤–µ—Ä—É. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω (–∫–æ–º–∞–Ω–¥–∞ npm start).', 'error');
                    } else {
                        showNotification(`–û—à–∏–±–∫–∞ API: ${error.message}`, 'error');
                    }
                } finally {
                    // 6. –°–±—Ä–æ—Å –∫–Ω–æ–ø–æ–∫ –≤ –ª—é–±–æ–º —Å–ª—É—á–∞–µ
                    btn.innerHTML = originalBtnText;
                    btn.disabled = false;
                    otherBtn.disabled = false;
                }
            }
            // --- –ö–æ–Ω–µ—Ü –Ω–æ–≤–æ–π —Ñ—É–Ω–∫—Ü–∏–∏ ---

function copyPrompt() {
    // –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –ò—Å–ø–æ–ª—å–∑—É–µ–º 'currentRawPrompt'
    const formattedPrompt = formatPromptOutput(currentRawPrompt, outputFormat.value);

    if (navigator.clipboard && window.isSecureContext) {
        navigator.clipboard.writeText(formattedPrompt)
            .then(() => {
                showNotification('–ü—Ä–æ–º–ø—Ç —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞', 'success');
            })
            .catch(err => {
                    showNotification('–ù–µ —É–¥–∞–ª–æ—Å—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –≤—Ä—É—á–Ω—É—é.', 'warning');
            });
    } else {
            showNotification('–ù–µ —É–¥–∞–ª–æ—Å—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –≤—Ä—É—á–Ω—É—é.', 'warning');
    }
}
            
            function editPrompt() {
                promptOutput.setAttribute('contenteditable', 'true');
                promptOutput.classList.add('bg-white', 'ring-2', 'ring-blue-500');
                promptOutput.classList.remove('bg-gray-50');
                promptOutput.focus();
                
                editBtn.innerHTML = `
                    <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>
                    –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
                `;
                editBtn.classList.add('bg-green-100', 'text-green-700', 'hover:bg-green-200');
                editBtn.classList.remove('bg-gray-100', 'text-gray-700', 'hover:bg-gray-200');

                editBtn.removeEventListener('click', editPrompt);
                editBtn.addEventListener('click', saveEditedPrompt);
            }
            
function saveEditedPrompt() {
    promptOutput.setAttribute('contenteditable', 'false');
    promptOutput.classList.remove('bg-white', 'ring-2', 'ring-blue-500');
    promptOutput.classList.add('bg-gray-50');

    // --- –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï ---
    // 1. –ü–æ–ª—É—á–∞–µ–º –≤–∏–¥–∏–º—ã–π —Ç–µ–∫—Å—Ç –∏–∑ div
    let newText = promptOutput.innerText;

    // 2. "–ù–æ—Ä–º–∞–ª–∏–∑—É–µ–º" –µ–≥–æ –æ–±—Ä–∞—Ç–Ω–æ –≤ –ø—Ä–æ–º–ø—Ç —Å –∑–∞–ø—è—Ç—ã–º–∏:
    //    - –ó–∞–º–µ–Ω—è–µ–º –º–∞—Ä–∫–µ—Ä—ã —Å–ø–∏—Å–∫–∞ "- " –Ω–∞ –ø—É—Å—Ç—É—é —Å—Ç—Ä–æ–∫—É
    //    - –ó–∞–º–µ–Ω—è–µ–º –ø–µ—Ä–µ–Ω–æ—Å—ã —Å—Ç—Ä–æ–∫ (\n) –Ω–∞ ", "
    newText = newText.replace(/-\s/g, '').replace(/\n/g, ', ');

    //    - –û—á–∏—â–∞–µ–º –æ—Ç –¥–≤–æ–π–Ω—ã—Ö –∑–∞–ø—è—Ç—ã—Ö –∏–ª–∏ –ø—Ä–æ–±–µ–ª–æ–≤
    newText = newText.replace(/, *,/g, ',').replace(/, ,/g, ',');

    // 3. –°–æ—Ö—Ä–∞–Ω—è–µ–º –∫–∞–∫ –Ω–æ–≤—ã–π "—á–∏—Å—Ç—ã–π" –ø—Ä–æ–º–ø—Ç
    currentRawPrompt = newText;

    // 4. –ü–µ—Ä–µ—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º
    updatePromptOutput();
    // --- –ö–û–ù–ï–¶ –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø ---

    editBtn.innerHTML = `
        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"></path></svg>
        –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
    `;
    editBtn.classList.remove('bg-green-100', 'text-green-700', 'hover:bg-green-200');
    editBtn.classList.add('bg-gray-100', 'text-gray-700', 'hover:bg-gray-200');

    editBtn.removeEventListener('click', saveEditedPrompt);
    editBtn.addEventListener('click', editPrompt);

    showNotification('–ò–∑–º–µ–Ω–µ–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã', 'success');
}
            
            function updateDurationValue() {
                durationValue.textContent = durationSlider.value;
                durationButtons.forEach(btn => btn.classList.remove('bg-blue-500', 'text-white', 'hover:bg-blue-600'));
                durationButtons.forEach(btn => btn.classList.add('bg-blue-50', 'text-blue-700', 'hover:bg-blue-100'));
                saveState();
            }

            function setDuration(event) {
                const newDuration = event.currentTarget.dataset.duration;
                durationValue.textContent = newDuration;
                durationSlider.value = newDuration;

                durationButtons.forEach(btn => {
                    if (btn === event.currentTarget) {
                        btn.classList.remove('bg-blue-50', 'text-blue-700', 'hover:bg-blue-100');
                        btn.classList.add('bg-blue-500', 'text-white', 'hover:bg-blue-600');
                    } else {
                        btn.classList.remove('bg-blue-500', 'text-white', 'hover:bg-blue-600');
                        btn.classList.add('bg-blue-50', 'text-blue-700', 'hover:bg-blue-100');
                    }
                });
                
                customDurationToggle.checked = false;
                customDurationSliderGroup.classList.add('hidden');
                saveState();
            }

            function toggleCustomDuration() {
                if (customDurationToggle.checked) {
                    customDurationSliderGroup.classList.remove('hidden');
                    durationButtons.forEach(btn => btn.classList.remove('bg-blue-500', 'text-white', 'hover:bg-blue-600'));
                    durationButtons.forEach(btn => btn.classList.add('bg-blue-50', 'text-blue-700', 'hover:bg-blue-100'));
                } else {
                    customDurationSliderGroup.classList.add('hidden');
                    let isButtonSelected = false;
                    durationButtons.forEach(btn => {
                        if (btn.classList.contains('bg-blue-500')) {
                            isButtonSelected = true;
                        }
                    });
                    if (!isButtonSelected) {
                        durationValue.textContent = '10';
                        durationSlider.value = '10';
                        document.querySelector('.duration-btn[data-duration="10"]').classList.remove('bg-blue-50', 'text-blue-700', 'hover:bg-blue-100');
                        document.querySelector('.duration-btn[data-duration="10"]').classList.add('bg-blue-500', 'text-white', 'hover:bg-blue-600');
                    }
                }
                saveState();
            }

            function regeneratePrompt() {
                generatePrompt();
            }
            
            function savePrompt() {
                showNotification('–ü—Ä–æ–º–ø—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω –≤ –≤–∞—à—É –±–∏–±–ª–∏–æ—Ç–µ–∫—É (—Å–∏–º—É–ª—è—Ü–∏—è)', 'success');
            }
            
            function exportPrompt() {
                const rawPrompt = promptOutput.textContent;
                const formattedPrompt = formatPromptOutput(rawPrompt, outputFormat.value);
                const negativePrompt = negativePromptTextarea.value.trim();
                let fullExport = formattedPrompt;
                if (negativePrompt) {
                    fullExport += `\n\n--- NEGATIVE PROMPT ---\n${negativePrompt}`;
                }

                const blob = new Blob([fullExport], { type: 'text/plain;charset=utf-8' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `ai_prompt_${new Date().toISOString().slice(0,10)}.txt`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                showNotification('–ü—Ä–æ–º–ø—Ç —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω –≤ .txt —Ñ–∞–π–ª', 'success');
            }
            
            function showNotification(message, type = 'info', hasUndo = false) {
                const colors = {
                    success: 'bg-green-500',
                    warning: 'bg-yellow-500',
                    info: 'bg-blue-500',
                    error: 'bg-red-500'
                };
                
                const notification = document.createElement('div');
                notification.className = `p-4 rounded-lg shadow-xl text-white font-medium mb-3 ${colors[type]} flex items-center justify-between notification-fade-in`;
                
                const textSpan = document.createElement('span');
                textSpan.textContent = message;
                notification.appendChild(textSpan);

                if (hasUndo) {
                    const undoButton = document.createElement('button');
                    undoButton.textContent = '–û—Ç–º–µ–Ω–∏—Ç—å';
                    undoButton.className = 'ml-4 px-3 py-1 bg-white text-gray-800 rounded-md font-bold hover:bg-gray-100 transition-colors';
                    undoButton.onclick = undoReset;
                    notification.appendChild(undoButton);
                }

                notificationContainer.appendChild(notification);
                
                setTimeout(() => {
                    if (!hasUndo || !notification.querySelector('button')) {
                        notification.classList.remove('notification-fade-in');
                        notification.classList.add('notification-fade-out');
                        notification.addEventListener('animationend', () => notification.remove());
                    }
                }, 5000);
            }

            function applyPreset(event) {
                const presetKey = event.currentTarget.dataset.preset;
                const preset = presets[presetKey];

                if (preset) {
                    // –°–±—Ä–æ—Å –≤—Å–µ—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –ø–µ—Ä–µ–¥ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ–º –ø—Ä–µ—Å–µ—Ç–∞
                    resetParameters(false); 

                    styleSelect.value = preset.style;
                    document.getElementById('camera').value = preset.camera;
                    document.getElementById('lighting').value = preset.lighting;
                    document.getElementById('cinematography').value = preset.cinematography;
                    document.getElementById('mood').value = preset.mood;
                    document.getElementById('effect').value = preset.effect;
                    document.getElementById('background').value = preset.background;
                    document.getElementById('audio').value = preset.audio;
                    detailsTextarea.value = preset.details;
                    negativePromptTextarea.value = preset.negative;

                    // –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è –∞–Ω–∏–º–µ
                    if (preset.style === 'anime') {
                        toggleAnimeOptions();
                        animeStudioSelect.value = preset.studio || '';
                        animeStyleSelect.value = preset.animeStyle || '';
                        animeMangaInput.value = preset.manga || '';
                    } else {
                        toggleAnimeOptions(); // –°–∫—Ä–æ–µ—Ç, –µ—Å–ª–∏ –Ω–µ –∞–Ω–∏–º–µ
                    }

                    // –°–±—Ä–æ—Å –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –Ω–∞ 10 —Å–µ–∫
                    setDuration({ currentTarget: document.querySelector('.duration-btn[data-duration="10"]') });

                    // –°–∫—Ä—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç, —á—Ç–æ–±—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∞–ª "–£–ª—É—á—à–∏—Ç—å"
                    resultSection.style.display = 'none';
                    
                    showNotification(`–ü—Ä–∏–º–µ–Ω–µ–Ω —à–∞–±–ª–æ–Ω: ${event.currentTarget.textContent}`, 'info');
                    saveState();
                }
            }

            function insertTag(event, textarea) {
                const tag = event.currentTarget.dataset.tag;
                let currentText = textarea.value.trim();
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —É–∂–µ —Ç–µ–≥, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è
                const tagRegex = new RegExp(`\\b${tag.replace(/[-\/\\^$*+?.()|[\]{}]/g, '\\$&')}\\b`, 'i');
                if (tagRegex.test(currentText)) {
                    showNotification(`–¢–µ–≥ "${tag}" —É–∂–µ –¥–æ–±–∞–≤–ª–µ–Ω.`, 'warning');
                    return;
                }

                if (currentText.length > 0) {
                    // –î–æ–±–∞–≤–ª—è–µ–º –∑–∞–ø—è—Ç—É—é –∏ –ø—Ä–æ–±–µ–ª, –µ—Å–ª–∏ –∏—Ö –Ω–µ—Ç
                    if (!currentText.endsWith(',')) {
                        currentText += ', ';
                    } else if (currentText.endsWith(',')) {
                        currentText += ' ';
                    }
                }

                textarea.value = currentText + tag;
                textarea.focus();
                saveState();
            }

            function resetParameters(showNotificationFlag = true) {
                if (showNotificationFlag) {
                    // 1. –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –¥–ª—è –æ—Ç–º–µ–Ω—ã
                    undoState = localStorage.getItem(STORAGE_KEY);
                }

                // –°–±—Ä–æ—Å —Å–µ–ª–µ–∫—Ç–æ–≤
                styleSelect.value = 'realistic';
                document.getElementById('camera').value = 'medium-shot';
                document.getElementById('lighting').value = 'natural';
                document.getElementById('cinematography').value = '16:9';
                document.getElementById('mood').value = 'epic';
                document.getElementById('effect').value = 'none';
                document.getElementById('background').value = 'urban-city';
                document.getElementById('audio').value = 'none';
                detailsTextarea.value = '';
                negativePromptTextarea.value = '';
                animeStudioSelect.value = '';
                animeStyleSelect.value = '';
                animeMangaInput.value = '';

                // –°–±—Ä–æ—Å —Ç–æ–≥–ª-–∫–Ω–æ–ø–æ–∫
                toggleCheckboxes.forEach(checkbox => checkbox.checked = true);
                parameterGroups.forEach(group => {
                    group.classList.remove('opacity-50');
                    group.querySelector('.param-content').style.display = 'block';
                });

                // –°–±—Ä–æ—Å –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
                setDuration({ currentTarget: document.querySelector('.duration-btn[data-duration="10"]') });
                
                // –°–±—Ä–æ—Å –º–æ–¥–µ–ª–∏ (Sora –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
                document.querySelector('input[name="model"][value="sora"]').checked = true;
                toggleAudioSelector();
                toggleAnimeOptions();

                // –°–∫—Ä—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
                resultSection.style.display = 'none';

                if (showNotificationFlag) {
                    showNotification('–í—Å–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Å–±—Ä–æ—à–µ–Ω—ã –∫ –∑–Ω–∞—á–µ–Ω–∏—è–º –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é.', 'info', true); // true –¥–ª—è –∫–Ω–æ–ø–∫–∏ "–û—Ç–º–µ–Ω–∏—Ç—å"
                }
                saveState();
            }

            function undoReset() {
                if (undoState) {
                    localStorage.setItem(STORAGE_KEY, undoState);
                    loadState(false); // –ó–∞–≥—Ä—É–∂–∞–µ–º –±–µ–∑ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
                    undoState = null;
                    // –£–¥–∞–ª—è–µ–º –≤—Å–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —Å –∫–Ω–æ–ø–∫–æ–π "–û—Ç–º–µ–Ω–∏—Ç—å"
                    notificationContainer.querySelectorAll('button').forEach(btn => btn.closest('div').remove());
                    showNotification('–°–±—Ä–æ—Å –æ—Ç–º–µ–Ω–µ–Ω. –°–æ—Å—Ç–æ—è–Ω–∏–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ.', 'success');
                }
            }

            function randomizeParameters() {
                // –†–∞–Ω–¥–æ–º–∏–∑–∞—Ü–∏—è —Å–µ–ª–µ–∫—Ç–æ–≤
                styleSelect.value = getRandomOption(styleSelect);
                document.getElementById('camera').value = getRandomOption(document.getElementById('camera'));
                document.getElementById('lighting').value = getRandomOption(document.getElementById('lighting'));
                document.getElementById('cinematography').value = getRandomOption(document.getElementById('cinematography'));
                document.getElementById('mood').value = getRandomOption(document.getElementById('mood'));
                document.getElementById('effect').value = getRandomOption(document.getElementById('effect'));
                document.getElementById('background').value = getRandomOption(document.getElementById('background'));
                document.getElementById('audio').value = getRandomOption(document.getElementById('audio'));
                
                // –†–∞–Ω–¥–æ–º–∏–∑–∞—Ü–∏—è –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
                const randomDuration = Math.floor(Math.random() * (60 - 4 + 1)) + 4;
                durationSlider.value = randomDuration;
                durationValue.textContent = randomDuration;
                customDurationToggle.checked = true;
                customDurationSliderGroup.classList.remove('hidden');
                durationButtons.forEach(btn => btn.classList.remove('bg-blue-500', 'text-white', 'hover:bg-blue-600'));
                durationButtons.forEach(btn => btn.classList.add('bg-blue-50', 'text-blue-700', 'hover:bg-blue-100'));

                // –†–∞–Ω–¥–æ–º–∏–∑–∞—Ü–∏—è —Ç–æ–≥–ª-–∫–Ω–æ–ø–æ–∫ (50/50)
                toggleCheckboxes.forEach(checkbox => {
                    checkbox.checked = Math.random() < 0.8; // –ß–∞—â–µ –æ—Å—Ç–∞–≤–ª—è–µ–º –≤–∫–ª—é—á–µ–Ω–Ω—ã–º–∏
                    const group = checkbox.closest('.parameter-group');
                    const content = group.querySelector('.param-content');
                    if (checkbox.checked) {
                        content.style.display = 'block';
                        group.classList.remove('opacity-50');
                    } else {
                        content.style.display = 'none';
                        group.classList.add('opacity-50');
                    }
                });

                // –†–∞–Ω–¥–æ–º–∏–∑–∞—Ü–∏—è –∞–Ω–∏–º–µ-—Å–µ–∫—Ü–∏–∏, –µ—Å–ª–∏ –≤—ã–±—Ä–∞–Ω –∞–Ω–∏–º–µ-—Å—Ç–∏–ª—å
                if (styleSelect.value === 'anime') {
                    toggleAnimeOptions();
                    animeStudioSelect.value = getRandomOption(animeStudioSelect);
                    animeStyleSelect.value = getRandomOption(animeStyleSelect);
                } else {
                    toggleAnimeOptions();
                }

                // –†–∞–Ω–¥–æ–º–∏–∑–∞—Ü–∏—è –∏–¥–µ–∏ (–ø—Ä–æ—Å—Ç–∞—è —Å–∏–º—É–ª—è—Ü–∏—è)
                const randomWords = ['Epic', 'Cinematic', 'Futuristic', 'Magical', 'Dystopian', 'Peaceful', 'Intense'];
                subjectInput.value = `${randomWords[Math.floor(Math.random() * randomWords.length)]} scene of a ${getRandomOption(document.getElementById('background')).split(' ')[0]} with a ${getRandomOption(document.getElementById('camera')).split(' ')[0]} shot.`;
                
                // –°–±—Ä–æ—Å —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö –ø–æ–ª–µ–π –¥–µ—Ç–∞–ª–µ–π –∏ –Ω–µ–≥–∞—Ç–∏–≤–Ω–æ–≥–æ –ø—Ä–æ–º–ø—Ç–∞
                detailsTextarea.value = '';
                negativePromptTextarea.value = '';

                // –°–∫—Ä—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
                resultSection.style.display = 'none';

                showNotification('–ü–∞—Ä–∞–º–µ—Ç—Ä—ã —Ä–∞–Ω–¥–æ–º–∏–∑–∏—Ä–æ–≤–∞–Ω—ã! –ù–∞–∂–º–∏—Ç–µ "–£–ª—É—á—à–∏—Ç—å –ø—Ä–æ–º–ø—Ç" –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏.', 'info');
                saveState();
            }

            // --- Custom Presets Logic ---
            const CUSTOM_PRESETS_KEY = 'aiPromptCreatorCustomPresetsV11';

            function saveCustomPreset() {
                const presetName = prompt("–í–≤–µ–¥–∏—Ç–µ –∏–º—è –¥–ª—è –≤–∞—à–µ–≥–æ –ø—Ä–µ—Å–µ—Ç–∞:", "–ú–æ–π –ø—Ä–µ—Å–µ—Ç");
                if (!presetName) return;

                const state = {
                    model: document.querySelector('input[name="model"]:checked').value,
                    enableModelSelection: enableModelSelectionCheckbox.checked,
                    subject: subjectInput.value,
                    styleLighting: styleLightingInput.value,
                    qualityResolution: qualityResolutionInput.value,
                    operatingMode: operatingModeSelect.value,
                    style: styleSelect.value,
                    camera: document.getElementById('camera').value,
                    lighting: document.getElementById('lighting').value,
                    cinematography: document.getElementById('cinematography').value,
                    mood: document.getElementById('mood').value,
                    effect: document.getElementById('effect').value,
                    background: document.getElementById('background').value,
                    audio: document.getElementById('audio').value,
                    details: detailsTextarea.value,
                    negative: negativePromptTextarea.value,
                    duration: durationSlider.value,
                    customDurationChecked: customDurationToggle.checked,
                    selectedDurationButton: document.querySelector('.duration-btn.bg-blue-500')?.dataset.duration || '10',
                    animeStudio: animeStudioSelect.value,
                    animeStyle: animeStyleSelect.value,
                    animeManga: animeMangaInput.value,
                    toggles: {}
                };

                toggleCheckboxes.forEach(checkbox => {
                    state.toggles[checkbox.id] = checkbox.checked;
                });

                const customPresets = JSON.parse(localStorage.getItem(CUSTOM_PRESETS_KEY)) || [];
                customPresets.push({ name: presetName, state: state });
                localStorage.setItem(CUSTOM_PRESETS_KEY, JSON.stringify(customPresets));

                loadCustomPresets();
                showNotification(`–ü—Ä–µ—Å–µ—Ç "${presetName}" —Å–æ—Ö—Ä–∞–Ω–µ–Ω!`, 'success');
            }

            function loadCustomPresets() {
                const customPresets = JSON.parse(localStorage.getItem(CUSTOM_PRESETS_KEY)) || [];
                customPresetsContainer.innerHTML = '';

                if (customPresets.length > 0) {
                    const title = document.createElement('h4');
                    title.className = 'text-md font-semibold mb-2 text-gray-700';
                    title.textContent = '–í–∞—à–∏ –ø—Ä–µ—Å–µ—Ç—ã:';
                    customPresetsContainer.appendChild(title);

                    const presetGrid = document.createElement('div');
                    presetGrid.className = 'flex flex-wrap gap-3';

                    customPresets.forEach((preset, index) => {
                        const presetWrapper = document.createElement('div');
                        presetWrapper.className = 'relative';

                        const btn = document.createElement('button');
                        btn.textContent = preset.name;
                        btn.className = 'custom-preset-btn px-4 py-2 bg-green-100 text-green-800 rounded-lg shadow-sm hover:bg-green-200 transition-colors duration-200 text-sm font-medium';
                        btn.addEventListener('click', () => applyCustomPreset(preset.state));

                        const deleteBtn = document.createElement('button');
                        deleteBtn.innerHTML = '&times;';
                        deleteBtn.className = 'absolute -top-1 -right-1 bg-red-500 text-white rounded-full h-5 w-5 flex items-center justify-center text-xs font-bold hover:bg-red-600';
                        deleteBtn.addEventListener('click', (e) => {
                            e.stopPropagation();
                            deleteCustomPreset(index);
                        });

                        presetWrapper.appendChild(btn);
                        presetWrapper.appendChild(deleteBtn);
                        presetGrid.appendChild(presetWrapper);
                    });
                    customPresetsContainer.appendChild(presetGrid);
                }
            }

            function applyCustomPreset(state) {
                localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
                loadState(false);
                showNotification('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –ø—Ä–µ—Å–µ—Ç –ø—Ä–∏–º–µ–Ω–µ–Ω!', 'success');
            }

            function deleteCustomPreset(index) {
                if (!confirm("–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –ø—Ä–µ—Å–µ—Ç?")) return;

                const customPresets = JSON.parse(localStorage.getItem(CUSTOM_PRESETS_KEY)) || [];
                customPresets.splice(index, 1);
                localStorage.setItem(CUSTOM_PRESETS_KEY, JSON.stringify(customPresets));

                loadCustomPresets();
                showNotification('–ü—Ä–µ—Å–µ—Ç —É–¥–∞–ª–µ–Ω.', 'info');
            }

            function resetAnimeParameters() {
                animeStudioSelect.value = '';
                animeStyleSelect.value = '';
                animeMangaInput.value = '';
                showNotification('–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∞–Ω–∏–º–µ —Å–±—Ä–æ—à–µ–Ω—ã.', 'info');
                saveState();
            }

async function translateToEnglish() {
    // –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –ò—Å–ø–æ–ª—å–∑—É–µ–º 'currentRawPrompt'
    const prompt = currentRawPrompt;
    if (!prompt) {
        showNotification('–°–Ω–∞—á–∞–ª–∞ —Å–≥–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ –ø—Ä–æ–º–ø—Ç.', 'warning');
        return;
    }

    try {
        const response = await fetch('http://localhost:3000/api/translate', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                text: prompt,
                generationModel: document.querySelector('input[name="generation-model"]:checked').value
            })
        });
        const data = await response.json();

        // --- –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï ---
        // 1. –°–æ—Ö—Ä–∞–Ω—è–µ–º "—á–∏—Å—Ç—ã–π" –ø–µ—Ä–µ–≤–æ–¥
        currentRawPrompt = data.translatedText;
        // 2. –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
        updatePromptOutput();
        // --- –ö–û–ù–ï–¶ –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø ---

        showNotification('–ü—Ä–æ–º–ø—Ç –ø–µ—Ä–µ–≤–µ–¥–µ–Ω –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–∏–π.', 'success');
    } catch (error) {
        showNotification('–û—à–∏–±–∫–∞ –ø–µ—Ä–µ–≤–æ–¥–∞.', 'error');
    }
}

            async function generateIdeas(type = 'subject') {
                try {
                    const response = await fetch('http://localhost:3000/api/generate-ideas', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            generationModel: document.querySelector('input[name="generation-model"]:checked').value,
                            type: type
                        })
                    });
                    const data = await response.json();
                    if (type === 'subject') {
                        subjectInput.value = data.idea;
                    } else if (type === 'style') {
                        styleLightingInput.value = data.idea;
                    } else if (type === 'quality') {
                        qualityResolutionInput.value = data.idea;
                    }
                    showNotification('–ù–æ–≤–∞—è –∏–¥–µ—è —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–∞!', 'success');
                } catch (error) {
                    showNotification('–û—à–∏–±–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏–¥–µ–π.', 'error');
                }
            }

            function clearNegativePrompt() {
                let currentNegativeText = negativePromptTextarea.value;

                if (currentNegativeText.length > 200) {
                    const commonNegativeTags = /\b(blurry|low quality|bad anatomy|deformed|watermark|text|signature|artifacts|poorly drawn|extra limbs|missing limbs|mutated|disfigured|out of frame|cropped)\b,? */gi;
                    let cleanedText = currentNegativeText.replace(commonNegativeTags, '');
                    // Clean up trailing commas and whitespace
                    cleanedText = cleanedText.replace(/, *,/g, ',').replace(/^, *|, *$/g, '').trim();
                    negativePromptTextarea.value = cleanedText;
                    showNotification('Common negative tags removed.', 'info');
                } else {
                    negativePromptTextarea.value = '';
                    showNotification('Negative prompt cleared.', 'info');
                }
                saveState();
            }

            function updatePromptVisualization() {
                const { sceneComplexity, fogIntensity, ...parameters } = collectAllParameters();
                let html = '';

                const idea = [subjectInput.value.trim(), styleLightingInput.value.trim(), qualityResolutionInput.value.trim()].filter(Boolean).join(', ');
                html += `<span class="text-blue-600">${idea}</span>`;

                for (const [key, value] of Object.entries(parameters)) {
                    if (value) {
                        html += `, <span class="text-green-600">${key}: ${value}</span>`;
                    }
                }

                if (sceneComplexity > 5) {
                    html += `, <span class="text-purple-600">scene complexity: ${sceneComplexity}</span>`;
                }
                if (fogIntensity !== 'none') {
                    html += `, <span class="text-gray-600">fog intensity: ${fogIntensity}</span>`;
                }

                promptVisualization.innerHTML = html;
                updatePresetHighlighting();
            }

            let currentRawPrompt = ""; // To store the unformatted prompt

            function updatePromptOutput() {
                const format = outputFormat.value;
                const text = currentRawPrompt;

                if (!text) return;

                const parts = text.split(',').map(p => p.trim()).filter(Boolean);

                let html;
                switch (format) {
                    case 'bullet':
                        html = '<ul>' + parts.map(part => {
                            const [key, ...value] = part.split(':');
                            const valueStr = value.join(':');
                            if (valueStr) {
                                return `<li><span class="text-red-500">${key}:</span><span class="text-blue-500">${valueStr}</span></li>`;
                            }
                            return `<li>${part}</li>`;
                        }).join('') + '</ul>';
                        break;
                    case 'flags':
                         html = parts.map(part => {
                            const [key, ...value] = part.split(':');
                            const valueStr = value.join(':').trim();
                            if (valueStr) {
                                 return `<span><span class="text-red-500">--${key.trim().replace(/\s+/g, '-')}</span> <span class="text-blue-500">${valueStr}</span></span>`;
                            }
                            return `<span>${part}</span>`;
                        }).join(' ');
                        break;
                    default: // comma
                        html = parts.map(part => {
                            const [key, ...value] = part.split(':');
                            const valueStr = value.join(':');
                            if (valueStr) {
                                return `<span><span class="text-red-500">${key}:</span><span class="text-blue-500">${valueStr}</span></span>`;
                            }
                            return `<span>${part}</span>`;
                        }).join(', ');
                        break;
                }

                promptOutput.innerHTML = html;
            }
            // --- History and Favorites Logic ---
            function saveToHistory() {
                const state = JSON.parse(localStorage.getItem(STORAGE_KEY));
                if (!state) return;

                let history = JSON.parse(localStorage.getItem(HISTORY_KEY)) || [];
                history.unshift({ ...state, id: Date.now() });
                if (history.length > 20) {
                    history.pop();
                }
                localStorage.setItem(HISTORY_KEY, JSON.stringify(history));
                loadHistory();
            }

            function addToFavorites() {
                const state = JSON.parse(localStorage.getItem(STORAGE_KEY));
                if (!state) {
                    showNotification('–°–Ω–∞—á–∞–ª–∞ —Å–≥–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ –ø—Ä–æ–º–ø—Ç.', 'warning');
                    return;
                }

                let favorites = JSON.parse(localStorage.getItem(FAVORITES_KEY)) || [];
                favorites.unshift({ ...state, id: Date.now() });
                localStorage.setItem(FAVORITES_KEY, JSON.stringify(favorites));
                loadFavorites();
                showNotification('–ü—Ä–æ–º–ø—Ç –¥–æ–±–∞–≤–ª–µ–Ω –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ.', 'success');
            }

            function loadHistory() {
                const history = JSON.parse(localStorage.getItem(HISTORY_KEY)) || [];
                renderList(historyList, history, 'history');
            }

            function loadFavorites() {
                const favorites = JSON.parse(localStorage.getItem(FAVORITES_KEY)) || [];
                renderList(favoritesList, favorites, 'favorites');
            }

            function renderList(container, items, type) {
                container.innerHTML = '';
                if (items.length === 0) {
                    container.innerHTML = `<p class="text-gray-500">–ù–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö –ø—Ä–æ–º–ø—Ç–æ–≤.</p>`;
                    return;
                }
                items.forEach(item => {
                    const div = document.createElement('div');
                    div.className = 'p-4 bg-gray-50 rounded-lg flex justify-between items-center';
                    div.innerHTML = `
                        <p class="text-sm text-gray-700 truncate">${item.subject || '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è'}</p>
                        <div class="flex space-x-2">
                            <button data-id="${item.id}" class="reuse-btn px-2 py-1 bg-blue-100 text-blue-700 rounded-md text-xs hover:bg-blue-200">–ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å</button>
                            ${type === 'history' ? `<button data-id="${item.id}" class="add-to-favorites-from-history-btn px-2 py-1 bg-yellow-100 text-yellow-700 rounded-md text-xs hover:bg-yellow-200">–í –∏–∑–±—Ä–∞–Ω–Ω–æ–µ</button>` : ''}
                            <button data-id="${item.id}" class="delete-btn px-2 py-1 bg-red-100 text-red-700 rounded-md text-xs hover:bg-red-200">–£–¥–∞–ª–∏—Ç—å</button>
                        </div>
                    `;
                    container.appendChild(div);
                });
            }

            function reusePrompt(id, type) {
                const items = JSON.parse(localStorage.getItem(type === 'history' ? HISTORY_KEY : FAVORITES_KEY)) || [];
                const item = items.find(i => i.id === id);
                if (item) {
                    localStorage.setItem(STORAGE_KEY, JSON.stringify(item));
                    loadState(false);
                    showNotification('–ü—Ä–æ–º–ø—Ç –∑–∞–≥—Ä—É–∂–µ–Ω.', 'success');
                }
            }

            function deletePrompt(id, type) {
                let items = JSON.parse(localStorage.getItem(type === 'history' ? HISTORY_KEY : FAVORITES_KEY)) || [];
                items = items.filter(i => i.id !== id);
                localStorage.setItem(type === 'history' ? HISTORY_KEY : FAVORITES_KEY, JSON.stringify(items));
                if (type === 'history') {
                    loadHistory();
                } else {
                    loadFavorites();
                }
                showNotification('–ü—Ä–æ–º–ø—Ç —É–¥–∞–ª–µ–Ω.', 'info');
            }

            function addToFavoritesFromHistory(id) {
                const history = JSON.parse(localStorage.getItem(HISTORY_KEY)) || [];
                const item = history.find(i => i.id === id);
                if (item) {
                    let favorites = JSON.parse(localStorage.getItem(FAVORITES_KEY)) || [];
                    favorites.unshift(item);
                    localStorage.setItem(FAVORITES_KEY, JSON.stringify(favorites));
                    loadFavorites();
                    showNotification('–ü—Ä–æ–º–ø—Ç –¥–æ–±–∞–≤–ª–µ–Ω –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ.', 'success');
                }
             }

            function filterAndSortPresets() {
                const filterValue = presetFilter.value.toLowerCase();
                const sortValue = presetSort.value;
                const presetButtonsContainer = document.getElementById('preset-buttons');

                let buttons = Array.from(presetButtonsContainer.querySelectorAll('.preset-btn'));

                // Filter
                buttons.forEach(btn => {
                    const presetName = btn.textContent.toLowerCase();
                    const presetKey = btn.dataset.preset;
                    const presetData = presets[presetKey];

                    let searchableText = presetName;
                    if (presetData) {
                        searchableText += ` ${presetData.style} ${presetData.mood}`;
                    }

                    if (searchableText.includes(filterValue)) {
                        btn.style.display = 'inline-block';
                    } else {
                        btn.style.display = 'none';
                    }
                });

                // Sort
                if (sortValue === 'name-asc') {
                    buttons.sort((a, b) => a.textContent.localeCompare(b.textContent));
                } else if (sortValue === 'name-desc') {
                    buttons.sort((a, b) => b.textContent.localeCompare(a.textContent));
                } else if (sortValue === 'style') {
                    buttons.sort((a, b) => {
                        const presetA = presets[a.dataset.preset];
                        const presetB = presets[b.dataset.preset];
                        if (presetA && presetB) {
                            return (presetA.style || '').localeCompare(presetB.style || '');
                        }
                        return 0;
                    });
                } else if (sortValue === 'mood') {
                    buttons.sort((a, b) => {
                        const presetA = presets[a.dataset.preset];
                        const presetB = presets[b.dataset.preset];
                        if (presetA && presetB) {
                            return (presetA.mood || '').localeCompare(presetB.mood || '');
                        }
                        return 0;
                    });
                }

                // Re-append to container
                buttons.forEach(btn => presetButtonsContainer.appendChild(btn));
            }

            function switchTab(tab) {
                if (tab === 'history') {
                    historyTab.classList.add('text-blue-600', 'border-blue-600');
                    historyTab.classList.remove('text-gray-500', 'hover:text-gray-700', 'hover:border-gray-300');
                    favoritesTab.classList.remove('text-blue-600', 'border-blue-600');
                    favoritesTab.classList.add('text-gray-500', 'hover:text-gray-700', 'hover:border-gray-300');
                    historyList.classList.remove('hidden');
                    favoritesList.classList.add('hidden');
                } else {
                    favoritesTab.classList.add('text-blue-600', 'border-blue-600');
                    favoritesTab.classList.remove('text-gray-500', 'hover:text-gray-700', 'hover:border-gray-300');
                    historyTab.classList.remove('text-blue-600', 'border-blue-600');
                    historyTab.classList.add('text-gray-500', 'hover:text-gray-700', 'hover:border-gray-300');
                    favoritesList.classList.remove('hidden');
                    historyList.classList.add('hidden');
                }
            }

            function updatePresetHighlighting() {
                const currentStyle = styleSelect.value;
                const currentLighting = document.getElementById('lighting').value;
                const currentMood = document.getElementById('mood').value;
                const currentCamera = document.getElementById('camera').value;
                const currentCinematography = document.getElementById('cinematography').value;
                const currentEffect = document.getElementById('effect').value;
                const currentBackground = document.getElementById('background').value;

                const currentSettings = {
                    style: currentStyle,
                    lighting: currentLighting,
                    mood: currentMood,
                    camera: currentCamera,
                    cinematography: currentCinematography,
                    effect: currentEffect,
                    background: currentBackground
                };

                presetButtons.forEach(btn => {
                    const presetKey = btn.dataset.preset;
                    const presetData = presets[presetKey];
                    if (!presetData) return;

                    let matchCount = 0;
                    for (const key in currentSettings) {
                        const selectElement = document.getElementById(key);
                        if (!selectElement) continue;

                        const group = selectElement.closest('.parameter-group');
                        const toggle = group?.querySelector('.toggle-checkbox');

                        if (toggle && !toggle.checked) {
                            continue;
                        }

                        if (presetData[key] && presetData[key] === currentSettings[key]) {
                            matchCount++;
                        }
                    }

                    if (matchCount >= 2) {
                        btn.classList.add('bg-yellow-200');
                    } else {
                        btn.classList.remove('bg-yellow-200');
                    }
                });
            }

            // --- Local Storage Functions ---
            function saveState() {
                const state = {
                    sceneComplexity: sceneComplexitySlider.value,
                    fogIntensity: fogIntensitySelect.value,
                    model: document.querySelector('input[name="model"]:checked').value,
                    enableModelSelection: enableModelSelectionCheckbox.checked,
                    subject: subjectInput.value,
                    styleLighting: styleLightingInput.value,
                    qualityResolution: qualityResolutionInput.value,
                    style: styleSelect.value,
                    camera: document.getElementById('camera').value,
                    lighting: document.getElementById('lighting').value,
                    cinematography: document.getElementById('cinematography').value,
                    mood: document.getElementById('mood').value,
                    effect: document.getElementById('effect').value,
                    background: document.getElementById('background').value,
                    audio: document.getElementById('audio').value,
                    details: detailsTextarea.value,
                    negative: negativePromptTextarea.value,
                    duration: durationSlider.value,
                    customDurationChecked: customDurationToggle.checked,
                    selectedDurationButton: document.querySelector('.duration-btn.bg-blue-500')?.dataset.duration || '10',
                    animeStudio: animeStudioSelect.value,
                    animeStyle: animeStyleSelect.value,
                    animeManga: animeMangaInput.value,
                    toggles: {}
                };
                
                toggleCheckboxes.forEach(checkbox => {
                    state.toggles[checkbox.id] = checkbox.checked;
                });

                localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
            }

            function loadState(showNotificationFlag = true) {
                const state = JSON.parse(localStorage.getItem(STORAGE_KEY));
                if (state) {
                    sceneComplexitySlider.value = state.sceneComplexity || '5';
                    sceneComplexityValue.textContent = state.sceneComplexity || '5';
                    fogIntensitySelect.value = state.fogIntensity || 'none';
                    // –ú–æ–¥–µ–ª—å
                    document.querySelector(`input[name="model"][value="${state.model}"]`).checked = true;
                    
                    // –ß–µ–∫–±–æ–∫—Å –≤—ã–±–æ—Ä–∞ –º–æ–¥–µ–ª–∏
                    if (state.enableModelSelection !== undefined) {
                        enableModelSelectionCheckbox.checked = state.enableModelSelection;
                    }
                    
                    // –¢–µ–∫—Å—Ç–æ–≤—ã–µ –ø–æ–ª—è
                    subjectInput.value = state.subject || '';
                    styleLightingInput.value = state.styleLighting || '';
                    qualityResolutionInput.value = state.qualityResolution || '';
                    operatingModeSelect.value = state.operatingMode || 'general';
                    detailsTextarea.value = state.details;
                    negativePromptTextarea.value = state.negative;

                    // –°–µ–ª–µ–∫—Ç—ã
                    styleSelect.value = state.style;
                    document.getElementById('camera').value = state.camera;
                    document.getElementById('lighting').value = state.lighting;
                    document.getElementById('cinematography').value = state.cinematography;
                    document.getElementById('mood').value = state.mood;
                    document.getElementById('effect').value = state.effect;
                    document.getElementById('background').value = state.background;
                    document.getElementById('audio').value = state.audio;
                    
                    // –ê–Ω–∏–º–µ
                    animeStudioSelect.value = state.animeStudio || '';
                    animeStyleSelect.value = state.animeStyle || '';
                    animeMangaInput.value = state.animeManga || '';

                    // –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
                    durationSlider.value = state.duration;
                    durationValue.textContent = state.duration;
                    customDurationToggle.checked = state.customDurationChecked;
                    
                    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–Ω–æ–ø–æ–∫ –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
                    durationButtons.forEach(btn => {
                        btn.classList.remove('bg-blue-500', 'text-white', 'hover:bg-blue-600');
                        btn.classList.add('bg-blue-50', 'text-blue-700', 'hover:bg-blue-100');
                        if (btn.dataset.duration === state.selectedDurationButton && !state.customDurationChecked) {
                            btn.classList.remove('bg-blue-50', 'text-blue-700', 'hover:bg-blue-100');
                            btn.classList.add('bg-blue-500', 'text-white', 'hover:bg-blue-600');
                        }
                    });

                    if (state.customDurationChecked) {
                        customDurationSliderGroup.classList.remove('hidden');
                    } else {
                        customDurationSliderGroup.classList.add('hidden');
                    }
                    
                    // –¢–æ–≥–≥–ª—ã
                    toggleCheckboxes.forEach(checkbox => {
                        if (state.toggles[checkbox.id] !== undefined) {
                            checkbox.checked = state.toggles[checkbox.id];
                            const group = checkbox.closest('.parameter-group');
                            const content = group.querySelector('.param-content');
                            if (checkbox.checked) {
                                content.style.display = 'block';
                                group.classList.remove('opacity-50');
                            } else {
                                content.style.display = 'none';
                                group.classList.add('opacity-50');
                            }
                        }
                    });

                    toggleAudioSelector();
                    toggleAnimeOptions();
                    
                    if (showNotificationFlag) {
                        showNotification('–°–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∑–∞–≥—Ä—É–∂–µ–Ω–æ.', 'info');
                    }
                } else {
                    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é, –µ—Å–ª–∏ –Ω–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è
                    document.querySelector('.duration-btn[data-duration="10"]').classList.add('bg-blue-500', 'text-white', 'hover:bg-blue-600');
                }
            }
            // --- End Local Storage Functions ---


            // --- –°–ª—É—à–∞—Ç–µ–ª–∏ —Å–æ–±—ã—Ç–∏–π ---
            const aiAutopilotBtn = document.getElementById('ai-autopilot-btn');
            improveBtn.addEventListener('click', () => generatePrompt(false));
            superImproveBtn.addEventListener('click', () => generatePrompt(true));
            aiAutopilotBtn.addEventListener('click', () => generatePrompt(false, 'auto-pilot'));
            copyBtn.addEventListener('click', copyPrompt);
            editBtn.addEventListener('click', editPrompt);
            durationSlider.addEventListener('input', updateDurationValue);
            regenerateBtn.addEventListener('click', regeneratePrompt);
            exportBtn.addEventListener('click', exportPrompt);
            resetParamsBtn.addEventListener('click', () => resetParameters(true));
            randomPromptBtn.addEventListener('click', randomizeParameters); // –ù–æ–≤–∞—è –∫–Ω–æ–ø–∫–∞

            durationButtons.forEach(btn => {
                btn.addEventListener('click', setDuration);
            });

            customDurationToggle.addEventListener('change', toggleCustomDuration);

            modelRadios.forEach(radio => {
                radio.addEventListener('change', toggleAudioSelector);
                radio.addEventListener('change', saveState);
            });
            
            enableModelSelectionCheckbox.addEventListener('change', toggleModelSelection);
            enableModelSelectionCheckbox.addEventListener('change', saveState);

            styleSelect.addEventListener('change', toggleAnimeOptions);
            styleSelect.addEventListener('change', saveState);

            presetButtons.forEach(btn => {
                btn.addEventListener('click', applyPreset);
            });

            // –ù–æ–≤–∞—è –ª–æ–≥–∏–∫–∞ –¥–ª—è –ë—ã—Å—Ç—Ä—ã—Ö —Ç–µ–≥–æ–≤
            quickTagContainers.forEach(container => {
                container.querySelectorAll('[data-tag]').forEach(btn => {
                    btn.addEventListener('click', (e) => insertTag(e, detailsTextarea));
                });
            });

            negativeTagContainer.querySelectorAll('[data-tag]').forEach(btn => {
                btn.addEventListener('click', (e) => insertTag(e, negativePromptTextarea));
            });

            // –°–ª—É—à–∞—Ç–µ–ª–∏ –¥–ª—è —Ç–æ–≥–ª-–∫–Ω–æ–ø–æ–∫
            toggleCheckboxes.forEach(checkbox => {
                checkbox.addEventListener('change', toggleParameterGroup);
                checkbox.addEventListener('change', saveState);
            });

            // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å–µ–ª–µ–∫—Ç–æ–≤ –∏ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö –ø–æ–ª–µ–π
            document.querySelectorAll('select, textarea, input[type="text"], input[type="range"]').forEach(element => {
                element.addEventListener('input', () => {
                    saveState();
                    updatePromptVisualization();
                    updatePresetHighlighting();
                });
                element.addEventListener('change', () => { // Also listen for change event for selects
                    saveState();
                    updatePromptVisualization();
                    updatePresetHighlighting();
                });
            });
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
            loadState(); // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
            loadCustomPresets(); // –ó–∞–≥—Ä—É–∂–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –ø—Ä–µ—Å–µ—Ç—ã
            loadHistory(); // –ó–∞–≥—Ä—É–∂–∞–µ–º –∏—Å—Ç–æ—Ä–∏—é
            loadFavorites(); // –ó–∞–≥—Ä—É–∂–∞–µ–º –∏–∑–±—Ä–∞–Ω–Ω–æ–µ
            toggleModelSelection(); // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –Ω–∞—á–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤—ã–±–æ—Ä–∞ –º–æ–¥–µ–ª–∏
            toggleAudioSelector(); // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –Ω–∞—á–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∞—É–¥–∏–æ—Å–µ–ª–µ–∫—Ç–æ—Ä–∞
            toggleAnimeOptions(); // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –Ω–∞—á–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∞–Ω–∏–º–µ-—Å–µ–∫—Ü–∏–∏
            updatePresetHighlighting(); // –ü–æ–¥—Å–≤–µ—á–∏–≤–∞–µ–º –ø—Ä–µ—Å–µ—Ç—ã –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ

            // --- –ù–æ–≤–∞—è –ª–æ–≥–∏–∫–∞ –¥–ª—è –∫–Ω–æ–ø–æ–∫ "–ü—Ä–µ–¥–ª–æ–∂–∏—Ç—å" ---
            const suggestButtons = document.querySelectorAll('.suggest-btn');
            
            async function handleSuggestClick(event) {
                const targetId = event.currentTarget.dataset.target;
                const idea = [subjectInput.value.trim(), styleLightingInput.value.trim(), qualityResolutionInput.value.trim()].filter(Boolean).join(', ');

                if (!idea) {
                    showNotification('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –≤–∞—à—É –∏–¥–µ—é, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ.', 'warning');
                    return;
                }

                const btn = event.currentTarget;
                const originalBtnText = btn.innerHTML;
                btn.innerHTML = `
                    <svg class="animate-spin h-5 w-5 mr-3" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a8 8 0 010 15.292M12 20.646a8 8 0 010-15.292"></path>
                    </svg>
                    –î—É–º–∞—é...
                `;
                btn.disabled = true;

                try {
                    // –°–∏–º—É–ª—è—Ü–∏—è –≤—ã–∑–æ–≤–∞ Gemini: –≤—ã–±–∏—Ä–∞–µ–º —Å–ª—É—á–∞–π–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –∏–∑ —Å–ø–∏—Å–∫–∞
                    await new Promise(resolve => setTimeout(resolve, 500)); // –ò–º–∏—Ç–∞—Ü–∏—è –∑–∞–¥–µ—Ä–∂–∫–∏ —Å–µ—Ç–∏

                    const targetSelect = document.getElementById(targetId);
                    if (targetSelect) {
                        const options = Array.from(targetSelect.options);
                        const validOptions = options.filter(opt => opt.value && opt.value !== 'none');
                        
                        if (validOptions.length > 0) {
                            const randomOption = validOptions[Math.floor(Math.random() * validOptions.length)];
                            targetSelect.value = randomOption.value;
                            
                            // –í—ã–∑—ã–≤–∞–µ–º —Å–æ–±—ã—Ç–∏–µ 'change', —á—Ç–æ–±—ã –æ–±–Ω–æ–≤–∏—Ç—å UI (–Ω–∞–ø—Ä–∏–º–µ—Ä, –¥–ª—è –∞–Ω–∏–º–µ-—Å–µ–∫—Ü–∏–∏)
                            targetSelect.dispatchEvent(new Event('change'));

                            showNotification(`–ü—Ä–µ–¥–ª–æ–∂–µ–Ω–æ: ${randomOption.text.split('(')[0].trim()}`, 'success');
                        }
                    } else {
                         showNotification(`–û—à–∏–±–∫–∞: –Ω–µ –Ω–∞–π–¥–µ–Ω —ç–ª–µ–º–µ–Ω—Ç –¥–ª—è "${targetId}"`, 'error');
                    }
                } catch (error) {
                    console.error('Suggestion failed:', error);
                    showNotification('–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ.', 'error');
                } finally {
                    btn.innerHTML = originalBtnText;
                    btn.disabled = false;
                }
                
                saveState(); // –°–æ—Ö—Ä–∞–Ω—è–µ–º –Ω–æ–≤–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
            }

            suggestButtons.forEach(btn => {
                btn.addEventListener('click', handleSuggestClick);
            });

            // --- –ù–æ–≤–∞—è –ª–æ–≥–∏–∫–∞ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –Ω–µ–≥–∞—Ç–∏–≤–Ω–æ–≥–æ –ø—Ä–æ–º–ø—Ç–∞ ---
            const generateNegativeBtn = document.getElementById('generate-negative-btn');

            const negativeSuggestions = {
                'pixel-art': ['blurry', 'photorealistic', 'high resolution', 'smooth', 'soft edges'],
                'anime': ['photorealistic', '3d render', 'realistic human proportions'],
                'realistic': ['cartoon', 'drawing', 'anime', '2d', 'flat'],
                'low-poly': ['photorealistic', 'hyperdetailed', 'smooth surfaces'],
                'manga-style': ['color', 'photorealistic', 'painting'],
                'default': ['low quality', 'blurry', 'artifacts', 'watermark', 'text', 'bad anatomy']
            };


            async function generateNegativePrompt() {
                const positivePrompt = promptOutput.textContent;
                if (!positivePrompt) {
                    showNotification('–°–Ω–∞—á–∞–ª–∞ —Å–≥–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ –æ—Å–Ω–æ–≤–Ω–æ–π –ø—Ä–æ–º–ø—Ç.', 'warning');
                    return;
                }

                try {
                    const response = await fetch('http://localhost:3000/api/generate-negative-prompt', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            prompt: positivePrompt,
                            generationModel: document.querySelector('input[name="generation-model"]:checked').value,
                            clean: true
                        })
                    });
                    const data = await response.json();
                    let currentNegativeText = negativePromptTextarea.value.trim();
                    if (currentNegativeText.length > 0 && !currentNegativeText.endsWith(',')) {
                        currentNegativeText += ', ';
                    }
                    negativePromptTextarea.value = currentNegativeText + data.generatedNegative;
                    showNotification('–ù–µ–≥–∞—Ç–∏–≤–Ω—ã–µ —Ç–µ–≥–∏ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω—ã.', 'success');
                } catch (error) {
                    showNotification('–û—à–∏–±–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –Ω–µ–≥–∞—Ç–∏–≤–Ω—ã—Ö —Ç–µ–≥–æ–≤.', 'error');
                }
                saveState();
            }

            generateNegativeBtn.addEventListener('click', generateNegativePrompt);

            // --- –ù–æ–≤–∞—è –ª–æ–≥–∏–∫–∞ –¥–ª—è –∞–≤—Ç–æ–∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è –∞–Ω–∏–º–µ-—Å–µ–∫—Ü–∏–∏ ---
            const animeTitleInput = document.getElementById('anime-manga-input');

            const animeTitleSuggestions = {
                'attack on titan': { studio: 'Wit Studio', style: 'Shonen Manga' },
                'shingeki no kyojin': { studio: 'Wit Studio', style: 'Shonen Manga' },
                'one piece': { studio: 'Toei Animation', style: 'Shonen Manga' },
                'naruto': { studio: 'Pierrot', style: 'Shonen Manga' },
                'jujutsu kaisen': { studio: 'MAPPA', style: 'Shonen Manga' },
                'demon slayer': { studio: 'Ufotable', style: 'Shonen Manga' },
                'kimetsu no yaiba': { studio: 'Ufotable', style: 'Shonen Manga' },
                'your name': { studio: 'CoMix Wave Films', style: 'Digital Painting' },
                'kimi no na wa': { studio: 'CoMix Wave Films', style: 'Digital Painting' },
                'spirited away': { studio: 'Studio Ghibli', style: 'Traditional Hand-Drawn' },
                'sen to chihiro no kamikakushi': { studio: 'Studio Ghibli', style: 'Traditional Hand-Drawn' }
            };

            async function handleAnimeTitleInput() {
                const title = animeTitleInput.value.trim();
                if (title.length < 3) return;

                try {
                    const response = await fetch('http://localhost:3000/api/anime-auto-fill', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            title: title,
                            generationModel: document.querySelector('input[name="generation-model"]:checked').value
                        })
                    });
                    const data = await response.json();

                    if (data.studio) {
                        animeStudioSelect.value = data.studio;
                    }
                    if (data.style) {
                        animeStyleSelect.value = data.style;
                    }
                    if (data.artist) {
                        document.getElementById('anime-artist').value = data.artist;
                    }

                    showNotification(`Auto-filled for "${title}"`, 'success');
                    saveState();

                } catch (error) {
                    console.error('Anime auto-fill failed:', error);
                }
            }

            animeTitleInput.addEventListener('input', handleAnimeTitleInput);

            // --- "Pick Tags" feature ---
            const suggestTagsBtn = document.getElementById('suggest-tags-btn');

            async function handleSuggestTags() {
                const idea = [subjectInput.value.trim(), styleLightingInput.value.trim(), qualityResolutionInput.value.trim()].filter(Boolean).join(', ');
                const prompt = promptOutput.textContent.trim();

                if (!idea) {
                    showNotification('Please enter an idea to suggest tags.', 'warning');
                    return;
                }

                if (!prompt) {
                    showNotification('Please generate a prompt before suggesting tags.', 'warning');
                    return;
                }

                const originalBtnText = suggestTagsBtn.innerHTML;
                suggestTagsBtn.innerHTML = `
                    <svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                    </svg>
                    Generating...
                `;
                suggestTagsBtn.disabled = true;

                try {
                    const response = await fetch('http://localhost:3000/api/generate-tags', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            idea: idea,
                            prompt: prompt,
                            generationModel: document.querySelector('input[name="generation-model"]:checked').value
                        })
                    });

                    if (!response.ok) {
                        const errorData = await response.json();
                        throw new Error(errorData.error || `Server error: ${response.status}`);
                    }

                    const data = await response.json();
                    let currentDetails = detailsTextarea.value.trim();
                    if (currentDetails.length > 0 && !currentDetails.endsWith(',')) {
                        currentDetails += ', ';
                    }
                    detailsTextarea.value = currentDetails + data.generatedTags;
                    showNotification('Tags generated successfully!', 'success');
                } catch (error) {
                    console.error('Tag suggestion failed:', error);
                    showNotification(`Error suggesting tags: ${error.message}`, 'error');
                } finally {
                    suggestTagsBtn.innerHTML = originalBtnText;
                    suggestTagsBtn.disabled = false;
                }
            }

            suggestTagsBtn.addEventListener('click', handleSuggestTags);

            // --- "Predict Problems" feature ---
            const predictProblemsBtn = document.getElementById('predict-problems-btn');
            const negativePromptGroups = document.getElementById('negative-prompt-groups');

            const negativeTagGroups = {
                standard: ['bad hands', 'low quality', 'blurry'],
                anime: ['text', 'watermark', 'low rating'],
                realistic: ['two heads', 'ugly skin', 'deformed body']
            };

            function updateNegativePromptFromGroups() {
                let activeTags = new Set();
                const checkboxes = negativePromptGroups.querySelectorAll('input[type="checkbox"]');
                checkboxes.forEach(checkbox => {
                    if (checkbox.checked) {
                        const group = checkbox.dataset.group;
                        negativeTagGroups[group].forEach(tag => activeTags.add(tag));
                    }
                });
                negativePromptTextarea.value = [...activeTags].join(', ');
                saveState();
            }

            negativePromptGroups.addEventListener('change', updateNegativePromptFromGroups);

            function applyWeight(textarea, weightInput) {
                let currentText = textarea.value.trim();
                if (currentText.endsWith(',')) {
                    currentText = currentText.slice(0, -1).trim();
                }
                const tags = currentText.split(',').map(t => t.trim());
                const lastTag = tags[tags.length - 1];
                const weight = parseFloat(weightInput.value);

                if (lastTag && !lastTag.includes(':') && weight > 0) {
                    tags[tags.length - 1] = `(${lastTag}:${weight})`;
                    textarea.value = tags.join(', ');
                    saveState();
                }
            }

            document.getElementById('details-weight').addEventListener('change', () => {
                applyWeight(detailsTextarea, document.getElementById('details-weight'));
            });

            document.getElementById('negative-weight').addEventListener('change', () => {
                applyWeight(negativePromptTextarea, document.getElementById('negative-weight'));
            });

            function handleDetailLevelClick(event) {
                const level = event.currentTarget.dataset.level;
                const tags = {
                    basic: ['high quality', 'detailed'],
                    detailed: ['masterpiece', 'best quality', 'highly detailed', 'photorealistic', 'cinematic light'],
                    masterpiece: ['ultra-detailed', '8k', 'extremely detailed face', 'volumetric light', 'trending on artstation', 'unreal engine 5', 'octane render']
                };

                let currentText = detailsTextarea.value.trim();
                const tagsToAdd = tags[level];

                tagsToAdd.forEach(tag => {
                    const tagRegex = new RegExp(`\\b${tag.replace(/[-\/\\^$*+?.()|[\]{}]/g, '\\$&')}\\b`, 'i');
                    if (!tagRegex.test(currentText)) {
                        if (currentText.length > 0 && !currentText.endsWith(',')) {
                            currentText += ', ';
                        } else if (currentText.length > 0) {
                            currentText += ' ';
                        }
                        currentText += tag;
                    }
                });

                detailsTextarea.value = currentText;
                showNotification(`–¢–µ–≥–∏ —É—Ä–æ–≤–Ω—è "${level}" –¥–æ–±–∞–≤–ª–µ–Ω—ã.`, 'success');
                saveState();
            }

            detailLevelButtons.forEach(btn => {
                btn.addEventListener('click', handleDetailLevelClick);
            });

            async function handlePredictProblems() {
                const idea = [subjectInput.value.trim(), styleLightingInput.value.trim(), qualityResolutionInput.value.trim()].filter(Boolean).join(', ');
                const prompt = promptOutput.textContent.trim();

                if (!idea) {
                    showNotification('Please enter an idea to predict problems.', 'warning');
                    return;
                }

                if (!prompt) {
                    showNotification('Please generate a prompt before predicting problems.', 'warning');
                    return;
                }

                const originalBtnText = predictProblemsBtn.innerHTML;
                predictProblemsBtn.innerHTML = `
                    <svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                    </svg>
                    Predicting...
                `;
                predictProblemsBtn.disabled = true;

                try {
                    const response = await fetch('http://localhost:3000/api/predict-problems', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            idea: idea,
                            prompt: prompt,
                            generationModel: document.querySelector('input[name="generation-model"]:checked').value
                        })
                    });

                    if (!response.ok) {
                        const errorData = await response.json();
                        throw new Error(errorData.error || `Server error: ${response.status}`);
                    }

                    const data = await response.json();
                    let currentNegative = negativePromptTextarea.value.trim();
                    if (currentNegative.length > 0 && !currentNegative.endsWith(',')) {
                        currentNegative += ', ';
                    }
                    negativePromptTextarea.value = currentNegative + data.predictedProblems;
                    showNotification('Problem prediction successful!', 'success');
                } catch (error) {
                    console.error('Problem prediction failed:', error);
                    showNotification(`Error predicting problems: ${error.message}`, 'error');
                } finally {
                    predictProblemsBtn.innerHTML = originalBtnText;
                    predictProblemsBtn.disabled = false;
                }
            }

            predictProblemsBtn.addEventListener('click', handlePredictProblems);
            createPresetBtn.addEventListener('click', saveCustomPreset);
            clearNegativeBtn.addEventListener('click', clearNegativePrompt);
            resetAnimeBtn.addEventListener('click', resetAnimeParameters);
            translateToEnglishBtn.addEventListener('click', translateToEnglish);
            generateIdeasBtn.addEventListener('click', () => generateIdeas('subject'));
            generateIdeasStyleBtn.addEventListener('click', () => generateIdeas('style'));
            generateIdeasQualityBtn.addEventListener('click', () => generateIdeas('quality'));
            addToFavoritesBtn.addEventListener('click', addToFavorites);
            historyTab.addEventListener('click', () => switchTab('history'));
            favoritesTab.addEventListener('click', () => switchTab('favorites'));
            generateCustomPresetBtn.addEventListener('click', generateCustomPreset);

            historyList.addEventListener('click', e => {
                if (e.target.classList.contains('reuse-btn')) {
                    reusePrompt(parseInt(e.target.dataset.id), 'history');
                }
                if (e.target.classList.contains('add-to-favorites-from-history-btn')) {
                    addToFavoritesFromHistory(parseInt(e.target.dataset.id));
                }
                if (e.target.classList.contains('delete-btn')) {
                    deletePrompt(parseInt(e.target.dataset.id), 'history');
                }
            });

            favoritesList.addEventListener('click', e => {
                if (e.target.classList.contains('reuse-btn')) {
                    reusePrompt(parseInt(e.target.dataset.id), 'favorites');
                }
                if (e.target.classList.contains('delete-btn')) {
                    deletePrompt(parseInt(e.target.dataset.id), 'favorites');
                }
            });

            presetFilter.addEventListener('input', filterAndSortPresets);
            presetSort.addEventListener('change', filterAndSortPresets);

            sceneComplexitySlider.addEventListener('input', () => {
                sceneComplexityValue.textContent = sceneComplexitySlider.value;
            });

            clearNegativeBtn.addEventListener('click', clearNegativePrompt);

            // --- Scroll to Top Logic ---
            window.addEventListener('scroll', () => {
                if (window.scrollY > 200) {
                    scrollToTopBtn.classList.remove('hidden');
                } else {
                    scrollToTopBtn.classList.add('hidden');
                }
            });

            scrollToTopBtn.addEventListener('click', () => {
                window.scrollTo({
                    top: 0,
                    behavior: 'smooth'
                });
            });

            function handleOperatingModeChange() {
                const selectedMode = operatingModeSelect.value;
                noNamesOptions.classList.toggle('hidden', selectedMode !== 'no-names');
                base64Options.classList.toggle('hidden', selectedMode !== 'base64');
            }

            operatingModeSelect.addEventListener('change', handleOperatingModeChange);
            outputFormat.addEventListener('change', updatePromptOutput);

            darkModeToggle.addEventListener('change', () => {
                document.documentElement.classList.toggle('dark');
                localStorage.setItem('darkMode', darkModeToggle.checked);
            });

            // The initial class is now set in the <head> to prevent FOUC.
            // We just need to ensure the toggle switch reflects the current state.
            if (document.documentElement.classList.contains('dark')) {
                darkModeToggle.checked = true;
            }

            tippy('[title]', {
                animation: 'scale-subtle',
                arrow: true,
            });

            improveBtn.setAttribute('aria-label', 'Improve Prompt');
            superImproveBtn.setAttribute('aria-label', 'Super Improve Prompt');
            resetParamsBtn.setAttribute('aria-label', 'Reset Parameters');
            randomPromptBtn.setAttribute('aria-label', 'Generate Random Prompt');
            copyBtn.setAttribute('aria-label', 'Copy Prompt');
            editBtn.setAttribute('aria-label', 'Edit Prompt');
            regenerateBtn.setAttribute('aria-label', 'Regenerate Prompt');
            exportBtn.setAttribute('aria-label', 'Export Prompt');
            addToFavoritesBtn.setAttribute('aria-label', 'Add to Favorites');
            createPresetBtn.setAttribute('aria-label', 'Create Custom Preset');
            generateCustomPresetBtn.setAttribute('aria-label', 'Generate Custom Preset with AI');

        });
    </script>
    <script src="https://unpkg.com/@popperjs/core@2"></script>
    <script src="https://unpkg.com/tippy.js@6"></script>
</body>
</html>
